import{_ as n,o as s,c as a,b as t}from"./app.32912d8e.js";const p="/vuepress-java/assets/image-20201122161002420.ccadf68f.png",e="/vuepress-java/assets/image-20201017104006281.c4542465.png",o="/vuepress-java/assets/image-20201017112543995.1b31b38b.png",c="/vuepress-java/assets/image-20201017112639162.0d6dd2d3.png",i="/vuepress-java/assets/image-20201017112802078.edfc4a90.png",l="/vuepress-java/assets/image-20201017113211471.49f5a1cc.png",u="/vuepress-java/assets/image-20201017113430118.7f019680.png",k="/vuepress-java/assets/image-20201017113536835.6d0f6208.png",r="/vuepress-java/assets/image-20201017113557135.19c34242.png",d="/vuepress-java/assets/image-20201017114136997.4b7e7f95.png",m="/vuepress-java/assets/1563979044942.b883e5ae.png",v="/vuepress-java/assets/1563979058395.633ed700.png",b="/vuepress-java/assets/1563979080567.c9efc12d.png",g="/vuepress-java/assets/1563979263800.d994ff12.png",f="/vuepress-java/assets/1563979739584.1573b996.png",q="/vuepress-java/assets/image-20201123103558410.e8c51703.png",h="/vuepress-java/assets/1563980059191.75f4b005.png",y="/vuepress-java/assets/image-20201123103650588.7676a892.png",w="/vuepress-java/assets/image-20201123103734310.71a121f7.png",_="/vuepress-java/assets/image-20201123103924768.14ce8731.png",S="/vuepress-java/assets/1563980211415.4eaaa738.png",I="/vuepress-java/assets/1564544646937.13b4fd14.png",x="/vuepress-java/assets/1564544663974.9fbbc0a4.png",j="/vuepress-java/assets/1564544823149.787b0066.png",U="/vuepress-java/assets/1564544871515.4933f57d.png",M="/vuepress-java/assets/1564544931311.c52eadec.png",R="/vuepress-java/assets/image-20201123155434121.cf758ee9.png",P="/vuepress-java/assets/image-20201123162229283.511bd9d7.png",C="/vuepress-java/assets/Figure-1-Mapping-Table-to-Collection-1.59d73567.png",E="/vuepress-java/assets/1544109001776.ea92f7ba.png",D="/vuepress-java/assets/1544109144162.d13e18ed.png",B="/vuepress-java/assets/image-20201123162352921.ec69f617.png",A={},O=t('<h2 id="\u8BFE\u7A0B\u4ECB\u7ECD" tabindex="-1"><a class="header-anchor" href="#\u8BFE\u7A0B\u4ECB\u7ECD" aria-hidden="true">#</a> \u8BFE\u7A0B\u4ECB\u7ECD</h2><ul><li>\u5B8C\u5584\u4E2A\u4EBA\u4FE1\u606F</li><li>\u963F\u91CC\u4E91OSS\u670D\u52A1\u5E94\u7528</li><li>\u4EBA\u8138\u8BC6\u522B</li><li>MongoDB\u5FEB\u901F\u5165\u95E8</li><li>SpringBoot\u6574\u5408MongoDB</li></ul><h2 id="_1\u3001\u5B8C\u5584\u4E2A\u4EBA\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#_1\u3001\u5B8C\u5584\u4E2A\u4EBA\u4FE1\u606F" aria-hidden="true">#</a> 1\u3001\u5B8C\u5584\u4E2A\u4EBA\u4FE1\u606F</h2><p>\u7528\u6237\u5728\u9996\u6B21\u767B\u5F55\u65F6\u9700\u8981\u5B8C\u5584\u4E2A\u4EBA\u4FE1\u606F\uFF0C\u5305\u62EC\u6027\u522B\u3001\u6635\u79F0\u3001\u751F\u65E5\u3001\u57CE\u5E02\u3001\u5934\u50CF\u7B49\u3002</p><p>\u5176\u4E2D\uFF0C\u5934\u50CF\u6570\u636E\u9700\u8981\u505A\u56FE\u7247\u4E0A\u4F20\uFF0C\u8FD9\u91CC\u91C7\u7528\u963F\u91CC\u4E91\u7684OSS\u670D\u52A1\u4F5C\u4E3A\u6211\u4EEC\u7684\u56FE\u7247\u670D\u52A1\u5668\uFF0C\u5E76\u4E14\u5BF9\u5934\u50CF\u8981\u505A\u4EBA\u8138\u8BC6\u522B\uFF0C\u975E\u4EBA\u8138\u7167\u7247\u4E0D\u5F97\u4E0A\u4F20\u3002</p><h3 id="_1-1\u3001\u56FE\u7247\u4E0A\u4F20" tabindex="-1"><a class="header-anchor" href="#_1-1\u3001\u56FE\u7247\u4E0A\u4F20" aria-hidden="true">#</a> 1.1\u3001\u56FE\u7247\u4E0A\u4F20</h3><h4 id="_1-1-1\u3001\u56FE\u7247\u5B58\u50A8\u89E3\u51B3\u65B9\u6848" tabindex="-1"><a class="header-anchor" href="#_1-1-1\u3001\u56FE\u7247\u5B58\u50A8\u89E3\u51B3\u65B9\u6848" aria-hidden="true">#</a> 1.1.1\u3001\u56FE\u7247\u5B58\u50A8\u89E3\u51B3\u65B9\u6848</h4><p>\u5B9E\u73B0\u56FE\u7247\u4E0A\u4F20\u670D\u52A1\uFF0C\u9700\u8981\u6709\u5B58\u50A8\u7684\u652F\u6301\uFF0C\u90A3\u4E48\u6211\u4EEC\u7684\u89E3\u51B3\u65B9\u6848\u5C06\u4EE5\u4E0B\u51E0\u79CD\uFF1A</p><ol><li>\u76F4\u63A5\u5C06\u56FE\u7247\u4FDD\u5B58\u5230\u670D\u52A1\u7684\u786C\u76D8 <ol><li>\u4F18\u70B9\uFF1A\u5F00\u53D1\u4FBF\u6377\uFF0C\u6210\u672C\u4F4E</li><li>\u7F3A\u70B9\uFF1A\u6269\u5BB9\u56F0\u96BE</li></ol></li><li>\u4F7F\u7528\u5206\u5E03\u5F0F\u6587\u4EF6\u7CFB\u7EDF\u8FDB\u884C\u5B58\u50A8 <ol><li>\u4F18\u70B9\uFF1A\u5BB9\u6613\u5B9E\u73B0\u6269\u5BB9</li><li>\u7F3A\u70B9\uFF1A\u5F00\u53D1\u590D\u6742\u5EA6\u7A0D\u5927\uFF08\u6709\u6210\u719F\u7684\u4EA7\u54C1\u53EF\u4EE5\u4F7F\u7528\uFF0C\u6BD4\u5982\uFF1AFastDFS\uFF09</li></ol></li><li>\u4F7F\u7528nfs\u505A\u5B58\u50A8 <ol><li>\u4F18\u70B9\uFF1A\u5F00\u53D1\u8F83\u4E3A\u4FBF\u6377</li><li>\u7F3A\u70B9\uFF1A\u9700\u8981\u6709\u4E00\u5B9A\u7684\u8FD0\u7EF4\u77E5\u8BC6\u8FDB\u884C\u90E8\u7F72\u548C\u7EF4\u62A4</li></ol></li><li>\u4F7F\u7528\u7B2C\u4E09\u65B9\u7684\u5B58\u50A8\u670D\u52A1 <ol><li>\u4F18\u70B9\uFF1A\u5F00\u53D1\u7B80\u5355\uFF0C\u62E5\u6709\u5F3A\u5927\u529F\u80FD\uFF0C\u514D\u7EF4\u62A4</li><li>\u7F3A\u70B9\uFF1A\u4ED8\u8D39</li></ol></li></ol><p>\u5728\u672C\u5957\u8BFE\u7A0B\u4E2D\u9009\u7528\u963F\u91CC\u4E91\u7684OSS\u670D\u52A1\u8FDB\u884C\u56FE\u7247\u5B58\u50A8\u3002</p><h4 id="_1-1-2\u3001\u963F\u91CC\u4E91oss\u5B58\u50A8" tabindex="-1"><a class="header-anchor" href="#_1-1-2\u3001\u963F\u91CC\u4E91oss\u5B58\u50A8" aria-hidden="true">#</a> 1.1.2\u3001\u963F\u91CC\u4E91OSS\u5B58\u50A8</h4><p>\u6D41\u7A0B\uFF1A</p><p><img src="'+p+'" alt="image-20201122161002420"></p><h5 id="_1-1-2-1\u3001\u4EC0\u4E48\u662Foss\u670D\u52A1" tabindex="-1"><a class="header-anchor" href="#_1-1-2-1\u3001\u4EC0\u4E48\u662Foss\u670D\u52A1" aria-hidden="true">#</a> 1.1.2.1\u3001\u4EC0\u4E48\u662FOSS\u670D\u52A1\uFF1F</h5><p>\u5730\u5740\uFF1Ahttps://www.aliyun.com/product/oss</p><p><img src="'+e+'" alt="image-20201017104006281"></p><h5 id="_1-1-2-2\u3001\u8D2D\u4E70\u670D\u52A1" tabindex="-1"><a class="header-anchor" href="#_1-1-2-2\u3001\u8D2D\u4E70\u670D\u52A1" aria-hidden="true">#</a> 1.1.2.2\u3001\u8D2D\u4E70\u670D\u52A1</h5><p>\u4F7F\u7528\u7B2C\u4E09\u65B9\u670D\u52A1\u6700\u5927\u7684\u7F3A\u70B9\u5C31\u662F\u9700\u8981\u4ED8\u8D39\uFF0C\u4E0B\u9762\uFF0C\u6211\u4EEC\u770B\u4E0B\u5982\u4F55\u8D2D\u4E70\u5F00\u901A\u670D\u52A1\u3002</p><p><img src="'+o+'" alt="image-20201017112543995"></p><p><img src="'+c+'" alt="image-20201017112639162"></p><p>\u8D2D\u4E70\u4E0B\u884C\u6D41\u91CF\u5305\uFF1A \uFF08\u4E0D\u8D2D\u4E70\u4E5F\u53EF\u4EE5\u4F7F\u7528\uFF0C\u6309\u7167\u6D41\u91CF\u4ED8\u8D39\uFF09</p><p><img src="'+i+'" alt="image-20201017112802078"></p><blockquote><p>\u8BF4\u660E\uFF1AOSS\u7684\u4E0A\u884C\u6D41\u91CF\u662F\u514D\u8D39\u7684\uFF0C\u4F46\u662F\u4E0B\u884C\u6D41\u91CF\u662F\u9700\u8981\u8D2D\u4E70\u7684\u3002</p></blockquote><h5 id="_1-1-2-3\u3001\u521B\u5EFAbucket" tabindex="-1"><a class="header-anchor" href="#_1-1-2-3\u3001\u521B\u5EFAbucket" aria-hidden="true">#</a> 1.1.2.3\u3001\u521B\u5EFABucket</h5><p>\u4F7F\u7528OSS\uFF0C\u9996\u5148\u9700\u8981\u521B\u5EFABucket\uFF0CBucket\u7FFB\u8BD1\u6210\u4E2D\u6587\u662F\u6C34\u6876\u7684\u610F\u601D\uFF0C\u628A\u5B58\u50A8\u7684\u56FE\u7247\u8D44\u6E90\u770B\u505A\u662F\u6C34\uFF0C\u60F3\u8981\u76DB\u6C34\u5FC5\u987B\u5F97\u6709\u6876\uFF0C\u5C31\u662F\u8FD9\u4E2A\u610F\u601D\u4E86\u3002</p><p>\u8FDB\u5165\u63A7\u5236\u53F0\uFF0Chttps://oss.console.aliyun.com/overview</p><p><img src="'+l+'" alt="image-20201017113211471"></p><p>\u9009\u62E9Bucket\u540E\uFF0C\u5373\u53EF\u770B\u5230\u5BF9\u5E94\u7684\u4FE1\u606F\uFF0C\u5982\uFF1Aurl\u3001\u6D88\u8017\u6D41\u91CF\u7B49 :</p><p><img src="'+u+'" alt="image-20201017113430118"></p><p>\u6587\u4EF6\u7BA1\u7406\uFF1A</p><p><img src="'+k+'" alt="image-20201017113536835"></p><p>\u67E5\u770B\u6587\u4EF6\uFF1A</p><p><img src="'+r+'" alt="image-20201017113557135"></p><h5 id="_1-1-2-4\u3001\u521B\u5EFA\u7528\u6237" tabindex="-1"><a class="header-anchor" href="#_1-1-2-4\u3001\u521B\u5EFA\u7528\u6237" aria-hidden="true">#</a> 1.1.2.4\u3001\u521B\u5EFA\u7528\u6237</h5><p>\u521B\u5EFA\u7528\u6237\u7684\u65B9\u5F0F\u4E0E\u77ED\u4FE1\u63A5\u53E3\u4E2D\u7684\u65B9\u5F0F\u4E00\u6837\uFF0C\u9700\u8981\u8BBE\u7F6Eoss\u6743\u9650\u3002</p><p><img src="'+d+`" alt="image-20201017114136997"></p><h4 id="_1-1-3\u3001\u5BFC\u5165\u4F9D\u8D56" tabindex="-1"><a class="header-anchor" href="#_1-1-3\u3001\u5BFC\u5165\u4F9D\u8D56" aria-hidden="true">#</a> 1.1.3\u3001\u5BFC\u5165\u4F9D\u8D56</h4><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun.oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-sdk-oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.8.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-1-4\u3001oss\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#_1-1-4\u3001oss\u914D\u7F6E" aria-hidden="true">#</a> 1.1.4\u3001OSS\u914D\u7F6E</h4><p>aliyun.properties\uFF1A</p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token key attr-name">aliyun.endpoint</span> <span class="token punctuation">=</span> <span class="token value attr-value">http://oss-cn-zhangjiakou.aliyuncs.com</span>
<span class="token key attr-name">aliyun.accessKeyId</span> <span class="token punctuation">=</span> <span class="token value attr-value">***********</span>
<span class="token key attr-name">aliyun.accessKeySecret</span> <span class="token punctuation">=</span> <span class="token value attr-value">***************</span>
<span class="token key attr-name">aliyun.bucketName</span><span class="token punctuation">=</span> <span class="token value attr-value">tanhua-dev</span>
<span class="token key attr-name">aliyun.urlPrefix</span><span class="token punctuation">=</span><span class="token value attr-value">http://tanhua-dev.oss-cn-zhangjiakou.aliyuncs.com/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>AliyunConfig\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>tanhua<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>oss<span class="token punctuation">.</span></span><span class="token class-name">OSSClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>context<span class="token punctuation">.</span>properties<span class="token punctuation">.</span></span><span class="token class-name">ConfigurationProperties</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PropertySource</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:aliyun.properties&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;aliyun&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AliyunConfig</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> endpoint<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> accessKeyId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> accessKeySecret<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> bucketName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> urlPrefix<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">OSSClient</span> <span class="token function">oSSClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">OSSClient</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-1-5\u3001picuploadservice" tabindex="-1"><a class="header-anchor" href="#_1-1-5\u3001picuploadservice" aria-hidden="true">#</a> 1.1.5\u3001PicUploadService</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>tanhua<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>oss<span class="token punctuation">.</span></span><span class="token class-name">OSSClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tanhua<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">AliyunConfig</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tanhua<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>vo<span class="token punctuation">.</span></span><span class="token class-name">PicUploadResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span></span><span class="token class-name">RandomUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>joda<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">DateTime</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>multipart<span class="token punctuation">.</span></span><span class="token class-name">MultipartFile</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ByteArrayInputStream</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PicUploadService</span> <span class="token punctuation">{</span>

    <span class="token comment">// \u5141\u8BB8\u4E0A\u4F20\u7684\u683C\u5F0F</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">IMAGE_TYPE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;.bmp&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.jpg&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;.jpeg&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.gif&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.png&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">OSSClient</span> ossClient<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AliyunConfig</span> aliyunConfig<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">PicUploadResult</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> uploadFile<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">PicUploadResult</span> fileUploadResult <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PicUploadResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u56FE\u7247\u505A\u6821\u9A8C\uFF0C\u5BF9\u540E\u7F00\u540D</span>
        <span class="token keyword">boolean</span> isLegal <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> type <span class="token operator">:</span> <span class="token constant">IMAGE_TYPE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">endsWithIgnoreCase</span><span class="token punctuation">(</span>uploadFile<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                isLegal <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isLegal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            fileUploadResult<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> fileUploadResult<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// \u6587\u4EF6\u65B0\u8DEF\u5F84</span>
        <span class="token class-name">String</span> fileName <span class="token operator">=</span> uploadFile<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> filePath <span class="token operator">=</span> <span class="token function">getFilePath</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// \u4E0A\u4F20\u5230\u963F\u91CC\u4E91</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u76EE\u5F55\u7ED3\u6784\uFF1Aimages/2018/12/29/xxxx.jpg</span>
            ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span>aliyunConfig<span class="token punctuation">.</span><span class="token function">getBucketName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> filePath<span class="token punctuation">,</span> <span class="token keyword">new</span>
                    <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>uploadFile<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//\u4E0A\u4F20\u5931\u8D25</span>
            fileUploadResult<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> fileUploadResult<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// \u4E0A\u4F20\u6210\u529F</span>
        fileUploadResult<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileUploadResult<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>aliyunConfig<span class="token punctuation">.</span><span class="token function">getUrlPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fileUploadResult<span class="token punctuation">.</span><span class="token function">setUid</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> fileUploadResult<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getFilePath</span><span class="token punctuation">(</span><span class="token class-name">String</span> sourceFileName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DateTime</span> dateTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">&quot;images/&quot;</span> <span class="token operator">+</span> dateTime<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy&quot;</span><span class="token punctuation">)</span>
                <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> dateTime<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;MM&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span>
                <span class="token operator">+</span> dateTime<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">&quot;dd&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                <span class="token class-name">RandomUtils</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span>
                <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">substringAfterLast</span><span class="token punctuation">(</span>sourceFileName<span class="token punctuation">,</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6240\u9700\u5176\u4ED6\u7684\u4EE3\u7801\uFF1A</p><p>PicUploadResult:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>tanhua<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>vo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PicUploadResult</span> <span class="token punctuation">{</span>

    <span class="token comment">// \u6587\u4EF6\u552F\u4E00\u6807\u8BC6</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> uid<span class="token punctuation">;</span>
    <span class="token comment">// \u6587\u4EF6\u540D</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token comment">// \u72B6\u6001\u6709\uFF1Auploading done error removed</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> status<span class="token punctuation">;</span>
    <span class="token comment">// \u670D\u52A1\u7AEF\u54CD\u5E94\u5185\u5BB9\uFF0C\u5982\uFF1A&#39;{&quot;status&quot;: &quot;success&quot;}&#39;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> response<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-1-6\u3001picuploadcontroller" tabindex="-1"><a class="header-anchor" href="#_1-1-6\u3001picuploadcontroller" aria-hidden="true">#</a> 1.1.6\u3001PicUploadController</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>tanhua<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tanhua<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">PicUploadService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tanhua<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>vo<span class="token punctuation">.</span></span><span class="token class-name">PicUploadResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestParam</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ResponseBody</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>multipart<span class="token punctuation">.</span></span><span class="token class-name">MultipartFile</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;pic/upload&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Controller</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PicUploadController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">PicUploadService</span> picUploadService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">PicUploadResult</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;file&quot;</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span> multipartFile<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>picUploadService<span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span>multipartFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-1-7\u3001\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#_1-1-7\u3001\u6D4B\u8BD5" aria-hidden="true">#</a> 1.1.7\u3001\u6D4B\u8BD5</h4><p><img src="`+m+'" alt="1563979044942"></p><p><img src="'+v+'" alt="1563979058395"></p><p><img src="'+b+'" alt="1563979080567"></p><h3 id="_1-2\u3001\u4EBA\u8138\u8BC6\u522B" tabindex="-1"><a class="header-anchor" href="#_1-2\u3001\u4EBA\u8138\u8BC6\u522B" aria-hidden="true">#</a> 1.2\u3001\u4EBA\u8138\u8BC6\u522B</h3><p>\u4EBA\u8138\u8BC6\u522B\u6280\u672F\u91C7\u7528\u8679\u8F6F\u5F00\u653E\u5E73\u53F0\u5B9E\u73B0\uFF08\u514D\u8D39\u4F7F\u7528\uFF09\u3002\u5B98\u7F51\uFF1Ahttps://www.arcsoft.com.cn/ <img src="'+g+'" alt="1563979263800"></p><h4 id="_1-2-1\u3001\u4F7F\u7528\u8BF4\u660E" tabindex="-1"><a class="header-anchor" href="#_1-2-1\u3001\u4F7F\u7528\u8BF4\u660E" aria-hidden="true">#</a> 1.2.1\u3001\u4F7F\u7528\u8BF4\u660E</h4><p>\u4F7F\u7528\u8679\u8F6F\u5E73\u53F0\u9700\u8981\u5148\u6CE8\u518C\u5F00\u53D1\u8005\u8D26\u53F7\uFF1Ahttps://ai.arcsoft.com.cn/ucenter/user/userlogin</p><p><img src="'+f+'" alt="1563979739584"></p><p>\u6CE8\u518C\u5B8C\u6210\u540E\u8FDB\u884C\u767B\u5F55\uFF0C\u7136\u540E\u8FDB\u884C\u521B\u5EFA\u5E94\u7528\uFF1A</p><p><img src="'+q+'" alt="image-20201123103558410"></p><p>\u521B\u5EFA\u5B8C\u6210\u540E\uFF0C\u9700\u8981\u8FDB\u884C\u5B9E\u540D\u8BA4\u8BC1\uFF0C\u5426\u5219\u76F8\u5173\u7684SDK\u662F\u4E0D\u80FD\u4F7F\u7528\u7684\u3002</p><p><img src="'+h+'" alt="1563980059191"></p><p>\u5B9E\u540D\u8BA4\u8BC1\u540E\u5373\u53EF\u4E0B\u8F7D\u5BF9\u5E94\u5E73\u53F0\u7684SDk\uFF0C\u6211\u4EEC\u9700\u8981\u4E0B\u8F7Dwindows\u4EE5\u53CAlinux\u5E73\u53F0\u3002</p><p>\u6DFB\u52A0SDK\uFF08Linux\u4E0EWindows\u5E73\u53F0\uFF09\uFF1A</p><p><img src="'+y+'" alt="image-20201123103650588"></p><p><img src="'+w+'" alt="image-20201123103734310"></p><p><img src="'+_+'" alt="image-20201123103924768"></p><p>\u4E0B\u8F7DSDK\uFF0C\u6253\u5F00\u89E3\u538B\u5305\uFF0C\u53EF\u4EE5\u770B\u5230\u6709\u63D0\u4F9B\u76F8\u5E94\u7684jar\u5305\u4EE5\u53CA\u793A\u4F8B\u4EE3\u7801\uFF1A</p><p><img src="'+S+`" alt="1563980211415"></p><p>\u9700\u8981\u7279\u522B\u8BF4\u660E\u7684\u662F\uFF1A\u6BCF\u4E2A\u8D26\u53F7\u7684SDK\u5305\u4E0D\u901A\u7528\uFF0C\u6240\u4EE5\u81EA\u5DF1\u8981\u4E0B\u8F7D\u81EA\u5DF1\u7684SDK\u5305\u3002</p><h4 id="_1-2-2\u3001\u5B89\u88C5jar\u5230\u672C\u5730\u4ED3\u5E93" tabindex="-1"><a class="header-anchor" href="#_1-2-2\u3001\u5B89\u88C5jar\u5230\u672C\u5730\u4ED3\u5E93" aria-hidden="true">#</a> 1.2.2\u3001\u5B89\u88C5jar\u5230\u672C\u5730\u4ED3\u5E93</h4><p>\u8FDB\u5165\u5230libs\u76EE\u5F55\uFF0C\u9700\u8981\u5C06arcsoft-sdk-face-3.0.0.0.jar\u5B89\u88C5\u5230\u672C\u5730\u4ED3\u5E93\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>mvn install:install-file <span class="token parameter variable">-DgroupId</span><span class="token operator">=</span>com.arcsoft.face <span class="token parameter variable">-DartifactId</span><span class="token operator">=</span>arcsoft-sdk-face <span class="token parameter variable">-Dversion</span><span class="token operator">=</span><span class="token number">3.0</span>.0.0 <span class="token parameter variable">-Dpackaging</span><span class="token operator">=</span>jar <span class="token parameter variable">-Dfile</span><span class="token operator">=</span>arcsoft-sdk-face-3.0.0.0.jar
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5B89\u88C5\u6210\u529F\u540E\uFF0C\u5373\u53EF\u901A\u8FC7maven\u5750\u6807\u5F15\u7528\u4E86\uFF1A</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.arcsoft.face<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>arcsoft-sdk-face<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--&lt;scope&gt;system&lt;/scope&gt;--&gt;</span>
    <span class="token comment">&lt;!--\u5982\u679C\u6CA1\u6709\u5B89\u88C5\u5230\u672C\u5730\u4ED3\u5E93\uFF0C\u53EF\u4EE5\u5C06jar\u5305\u62F7\u8D1D\u5230\u5DE5\u7A0B\u7684lib\u4E0B\u9762\u4E0B\uFF0C\u76F4\u63A5\u5F15\u7528--&gt;</span>
    <span class="token comment">&lt;!--&lt;systemPath&gt;\${project.basedir}/lib/arcsoft-sdk-face-3.0.0.0.jar&lt;/systemPath&gt;--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-2-3\u3001\u5F00\u59CB\u4F7F\u7528" tabindex="-1"><a class="header-anchor" href="#_1-2-3\u3001\u5F00\u59CB\u4F7F\u7528" aria-hidden="true">#</a> 1.2.3\u3001\u5F00\u59CB\u4F7F\u7528</h4><blockquote><p>\u8BF4\u660E\uFF1A\u8679\u8F6F\u7684SDK\u662F\u514D\u8D39\u4F7F\u7528\u7684\uFF0C\u4F46\u662F\u9996\u6B21\u4F7F\u7528\u65F6\u9700\u8981\u8054\u7F51\u6FC0\u6D3B\uFF0C\u6FC0\u6D3B\u540E\u53EF\u79BB\u7EBF\u4F7F\u7528\u3002\u4F7F\u7528\u5468\u671F\u4E3A1\u5E74\uFF0C1\u5E74\u540E\u9700\u8981\u8054\u7F51\u518D\u6B21\u6FC0\u6D3B\u3002</p><p>\u4E2A\u4EBA\u514D\u8D39\u6FC0\u6D3BSDK\u603B\u6570\u91CF\u4E3A100\u3002</p></blockquote><p>\u914D\u7F6E\uFF1Aapplication.properties</p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#\u8679\u8F6F\u76F8\u5173\u914D\u7F6E(\u5728\u8679\u8F6F\u5E94\u7528\u4E2D\u627E\u5230\u5BF9\u5E94\u7684\u53C2\u6570)</span>
<span class="token key attr-name">arcsoft.appid</span><span class="token punctuation">=</span><span class="token value attr-value">******************</span>
<span class="token key attr-name">arcsoft.sdkKey</span><span class="token punctuation">=</span><span class="token value attr-value">*****************</span>
<span class="token key attr-name">arcsoft.libPath</span><span class="token punctuation">=</span><span class="token value attr-value">F:\\\\code\\\\WIN64</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>FaceEngineService\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>tanhua<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>arcsoft<span class="token punctuation">.</span>face<span class="token punctuation">.</span></span><span class="token class-name">EngineConfiguration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>arcsoft<span class="token punctuation">.</span>face<span class="token punctuation">.</span></span><span class="token class-name">FaceEngine</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>arcsoft<span class="token punctuation">.</span>face<span class="token punctuation">.</span></span><span class="token class-name">FaceInfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>arcsoft<span class="token punctuation">.</span>face<span class="token punctuation">.</span></span><span class="token class-name">FunctionConfiguration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>arcsoft<span class="token punctuation">.</span>face<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">DetectMode</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>arcsoft<span class="token punctuation">.</span>face<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">DetectOrient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>arcsoft<span class="token punctuation">.</span>face<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">ErrorInfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>arcsoft<span class="token punctuation">.</span>face<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">ImageFormat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>arcsoft<span class="token punctuation">.</span>face<span class="token punctuation">.</span>toolkit<span class="token punctuation">.</span></span><span class="token class-name">ImageFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>arcsoft<span class="token punctuation">.</span>face<span class="token punctuation">.</span>toolkit<span class="token punctuation">.</span></span><span class="token class-name">ImageInfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostConstruct</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FaceEngineService</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> <span class="token constant">LOGGER</span> <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">FaceEngineService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${arcsoft.appid}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> appid<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${arcsoft.sdkKey}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> sdkKey<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${arcsoft.libPath}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> libPath<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">FaceEngine</span> faceEngine<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostConstruct</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u6FC0\u6D3B\u5E76\u4E14\u521D\u59CB\u5316\u5F15\u64CE</span>
        <span class="token class-name">FaceEngine</span> faceEngine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FaceEngine</span><span class="token punctuation">(</span>libPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> activeCode <span class="token operator">=</span> faceEngine<span class="token punctuation">.</span><span class="token function">activeOnline</span><span class="token punctuation">(</span>appid<span class="token punctuation">,</span> sdkKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>activeCode <span class="token operator">!=</span> <span class="token class-name">ErrorInfo</span><span class="token punctuation">.</span><span class="token constant">MOK</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> activeCode <span class="token operator">!=</span> <span class="token class-name">ErrorInfo</span><span class="token punctuation">.</span><span class="token constant">MERR_ASF_ALREADY_ACTIVATED</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;\u5F15\u64CE\u6FC0\u6D3B\u5931\u8D25&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;\u5F15\u64CE\u6FC0\u6D3B\u5931\u8D25&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//\u5F15\u64CE\u914D\u7F6E</span>
        <span class="token class-name">EngineConfiguration</span> engineConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EngineConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//IMAGE\u68C0\u6D4B\u6A21\u5F0F\uFF0C\u7528\u4E8E\u5904\u7406\u5355\u5F20\u7684\u56FE\u50CF\u6570\u636E</span>
        engineConfiguration<span class="token punctuation">.</span><span class="token function">setDetectMode</span><span class="token punctuation">(</span><span class="token class-name">DetectMode</span><span class="token punctuation">.</span><span class="token constant">ASF_DETECT_MODE_IMAGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//\u4EBA\u8138\u68C0\u6D4B\u89D2\u5EA6\uFF0C\u5168\u89D2\u5EA6</span>
        engineConfiguration<span class="token punctuation">.</span><span class="token function">setDetectFaceOrientPriority</span><span class="token punctuation">(</span><span class="token class-name">DetectOrient</span><span class="token punctuation">.</span><span class="token constant">ASF_OP_ALL_OUT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u529F\u80FD\u914D\u7F6E</span>
        <span class="token class-name">FunctionConfiguration</span> functionConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FunctionConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        functionConfiguration<span class="token punctuation">.</span><span class="token function">setSupportAge</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        functionConfiguration<span class="token punctuation">.</span><span class="token function">setSupportFace3dAngle</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        functionConfiguration<span class="token punctuation">.</span><span class="token function">setSupportFaceDetect</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        functionConfiguration<span class="token punctuation">.</span><span class="token function">setSupportFaceRecognition</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        functionConfiguration<span class="token punctuation">.</span><span class="token function">setSupportGender</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        functionConfiguration<span class="token punctuation">.</span><span class="token function">setSupportLiveness</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        functionConfiguration<span class="token punctuation">.</span><span class="token function">setSupportIRLiveness</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        engineConfiguration<span class="token punctuation">.</span><span class="token function">setFunctionConfiguration</span><span class="token punctuation">(</span>functionConfiguration<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//\u521D\u59CB\u5316\u5F15\u64CE</span>
        <span class="token keyword">int</span> initCode <span class="token operator">=</span> faceEngine<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>engineConfiguration<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>initCode <span class="token operator">!=</span> <span class="token class-name">ErrorInfo</span><span class="token punctuation">.</span><span class="token constant">MOK</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;\u521D\u59CB\u5316\u5F15\u64CE\u51FA\u9519!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;\u521D\u59CB\u5316\u5F15\u64CE\u51FA\u9519!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>faceEngine <span class="token operator">=</span> faceEngine<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u68C0\u6D4B\u56FE\u7247\u662F\u5426\u4E3A\u4EBA\u50CF
     *
     * <span class="token keyword">@param</span> <span class="token parameter">imageInfo</span> \u56FE\u50CF\u5BF9\u8C61
     * <span class="token keyword">@return</span> true:\u4EBA\u50CF\uFF0Cfalse:\u975E\u4EBA\u50CF
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">checkIsPortrait</span><span class="token punctuation">(</span><span class="token class-name">ImageInfo</span> imageInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// \u5B9A\u4E49\u4EBA\u8138\u5217\u8868</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FaceInfo</span><span class="token punctuation">&gt;</span></span> faceInfoList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FaceInfo</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        faceEngine<span class="token punctuation">.</span><span class="token function">detectFaces</span><span class="token punctuation">(</span>imageInfo<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> imageInfo<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> imageInfo<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ImageFormat</span><span class="token punctuation">.</span><span class="token constant">CP_PAF_BGR24</span><span class="token punctuation">,</span> faceInfoList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">!</span>faceInfoList<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">checkIsPortrait</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> imageData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkIsPortrait</span><span class="token punctuation">(</span><span class="token class-name">ImageFactory</span><span class="token punctuation">.</span><span class="token function">getRGBData</span><span class="token punctuation">(</span>imageData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">checkIsPortrait</span><span class="token punctuation">(</span><span class="token class-name">File</span> file<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkIsPortrait</span><span class="token punctuation">(</span><span class="token class-name">ImageFactory</span><span class="token punctuation">.</span><span class="token function">getRGBData</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#\u95EE\u9898\uFF1A</span>
Caused by: java.lang.UnsatisfiedLinkError: D:<span class="token punctuation">\\</span>gongju<span class="token punctuation">\\</span>renlian<span class="token punctuation">\\</span>haha<span class="token punctuation">\\</span>libs<span class="token punctuation">\\</span>WIN64<span class="token punctuation">\\</span>libarcsoft_face.dll: Can&#39;t <span class="token function">find</span> dependent libraries

\u89E3\u51B3\uFF1A
\u5B89\u88C5\u8D44\u6599\u4E2D\u7684\uFF1Avcredist_x64.exe\uFF0C\u5373\u53EF\u89E3\u51B3\u3002
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-2-4\u3001\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#_1-2-4\u3001\u6D4B\u8BD5" aria-hidden="true">#</a> 1.2.4\u3001\u6D4B\u8BD5</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>tanhua<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span><span class="token class-name">RunWith</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span><span class="token class-name">SpringJUnit4ClassRunner</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringJUnit4ClassRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestFaceEngineService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">FaceEngineService</span> faceEngineService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testCheckIsPortrait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;F:\\\\1.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> checkIsPortrait <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>faceEngineService<span class="token punctuation">.</span><span class="token function">checkIsPortrait</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>checkIsPortrait<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true|false</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-3\u3001\u5B9E\u73B0\u5B8C\u5584\u4E2A\u4EBA\u4FE1\u606F" tabindex="-1"><a class="header-anchor" href="#_1-3\u3001\u5B9E\u73B0\u5B8C\u5584\u4E2A\u4EBA\u4FE1\u606F" aria-hidden="true">#</a> 1.3\u3001\u5B9E\u73B0\u5B8C\u5584\u4E2A\u4EBA\u4FE1\u606F</h3><p>\u5B8C\u5584\u4E2A\u4EBA\u4FE1\u606F\u7684\u529F\u80FD\u5B9E\u73B0\uFF0C\u5206\u4E3A2\u4E2A\u63A5\u53E3\u5B8C\u6210\uFF0C\u5206\u522B\u662F\uFF1A\u5B8C\u5584\u4E2A\u4EBA\u8D44\u6599\u4FE1\u606F\u3001\u5934\u50CF\u4E0A\u4F20\u3002</p><p>mock\u63A5\u53E3\uFF1A</p><ul><li>\u5B8C\u5584\u4E2A\u4EBA\u4FE1\u606F <ul><li>https://mock.boxuegu.com/project/164/interface/api/28553</li><li><img src="`+I+'" alt="1564544646937"></li></ul></li><li>\u4E0A\u4F20\u5934\u50CF <ul><li>https://mock.boxuegu.com/project/164/interface/api/39725</li><li><img src="'+x+`" alt="1564544663974"></li></ul></li></ul><h4 id="_1-3-1\u3001userinfomapper" tabindex="-1"><a class="header-anchor" href="#_1-3-1\u3001userinfomapper" aria-hidden="true">#</a> 1.3.1\u3001UserInfoMapper</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>tanhua<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">BaseMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tanhua<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">UserInfo</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserInfoMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-3-2\u3001userinfoservice" tabindex="-1"><a class="header-anchor" href="#_1-3-2\u3001userinfoservice" aria-hidden="true">#</a> 1.3.2\u3001UserInfoService</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>tanhua<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>baomidou<span class="token punctuation">.</span>mybatisplus<span class="token punctuation">.</span>core<span class="token punctuation">.</span>conditions<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">QueryWrapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tanhua<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>enums<span class="token punctuation">.</span></span><span class="token class-name">SexEnum</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tanhua<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>mapper<span class="token punctuation">.</span></span><span class="token class-name">UserInfoMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tanhua<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">User</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tanhua<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">UserInfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tanhua<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>vo<span class="token punctuation">.</span></span><span class="token class-name">PicUploadResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>multipart<span class="token punctuation">.</span></span><span class="token class-name">MultipartFile</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfoService</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserInfoMapper</span> userInfoMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">FaceEngineService</span> faceEngineService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">PicUploadService</span> picUploadService<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">saveUserInfo</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> param<span class="token punctuation">,</span> <span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u6821\u9A8Ctoken</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">queryUserByToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">UserInfo</span> userInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userInfo<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userInfo<span class="token punctuation">.</span><span class="token function">setSex</span><span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;gender&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;man&quot;</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token class-name">SexEnum</span><span class="token punctuation">.</span><span class="token constant">MAN</span> <span class="token operator">:</span> <span class="token class-name">SexEnum</span><span class="token punctuation">.</span><span class="token constant">WOMAN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userInfo<span class="token punctuation">.</span><span class="token function">setNickName</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;nickname&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userInfo<span class="token punctuation">.</span><span class="token function">setBirthday</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;birthday&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userInfo<span class="token punctuation">.</span><span class="token function">setCity</span><span class="token punctuation">(</span>param<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;city&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userInfoMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">saveUserLogo</span><span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> file<span class="token punctuation">,</span> <span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//\u6821\u9A8Ctoken</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">queryUserByToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//\u6821\u9A8C\u56FE\u7247\u662F\u5426\u662F\u4EBA\u50CF\uFF0C\u5982\u679C\u4E0D\u662F\u4EBA\u50CF\u5C31\u8FD4\u56DEfalse</span>
            <span class="token keyword">boolean</span> b <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>faceEngineService<span class="token punctuation">.</span><span class="token function">checkIsPortrait</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//\u56FE\u7247\u4E0A\u4F20\u5230\u963F\u91CC\u4E91OSS</span>
        <span class="token class-name">PicUploadResult</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>picUploadService<span class="token punctuation">.</span><span class="token function">upload</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//\u4E0A\u4F20\u5931\u8D25</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//\u628A\u5934\u50CF\u4FDD\u5B58\u5230\u7528\u6237\u4FE1\u606F\u8868\u4E2D</span>
        <span class="token class-name">UserInfo</span> userInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userInfo<span class="token punctuation">.</span><span class="token function">setLogo</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;user_id&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userInfoMapper<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">,</span> queryWrapper<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-3-3\u3001userinfocontroller" tabindex="-1"><a class="header-anchor" href="#_1-3-3\u3001userinfocontroller" aria-hidden="true">#</a> 1.3.3\u3001UserInfoController</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>tanhua<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tanhua<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">UserInfoService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tanhua<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">UserService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>tanhua<span class="token punctuation">.</span>sso<span class="token punctuation">.</span>vo<span class="token punctuation">.</span></span><span class="token class-name">ErrorResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang3<span class="token punctuation">.</span></span><span class="token class-name">StringUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpStatus</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">ResponseEntity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>multipart<span class="token punctuation">.</span></span><span class="token class-name">MultipartFile</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfoController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserInfoService</span> userInfoService<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * \u5B8C\u5584\u4E2A\u4EBA\u4FE1\u606F-\u57FA\u672C\u4FE1\u606F
     *
     * <span class="token keyword">@param</span> <span class="token parameter">param</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;loginReginfo&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">saveUserInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> param<span class="token punctuation">,</span>
                                               <span class="token annotation punctuation">@RequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Authorization&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Boolean</span> bool <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userInfoService<span class="token punctuation">.</span><span class="token function">saveUserInfo</span><span class="token punctuation">(</span>param<span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">ErrorResult</span> errorResult <span class="token operator">=</span> <span class="token class-name">ErrorResult</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">errCode</span><span class="token punctuation">(</span><span class="token string">&quot;000001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">errMessage</span><span class="token punctuation">(</span><span class="token string">&quot;\u4FDD\u5B58\u7528\u6237\u4FE1\u606F\u5931\u8D25\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>errorResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * \u5B8C\u5584\u4E2A\u4EBA\u4FE1\u606F-\u7528\u6237\u5934\u50CF
     *
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;loginReginfo/head&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">saveUserLogo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">&quot;headPhoto&quot;</span><span class="token punctuation">)</span> <span class="token class-name">MultipartFile</span> file<span class="token punctuation">,</span>
                                               <span class="token annotation punctuation">@RequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Authorization&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Boolean</span> bool <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userInfoService<span class="token punctuation">.</span><span class="token function">saveUserLogo</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">ErrorResult</span> errorResult <span class="token operator">=</span> <span class="token class-name">ErrorResult</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">errCode</span><span class="token punctuation">(</span><span class="token string">&quot;000001&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">errMessage</span><span class="token punctuation">(</span><span class="token string">&quot;\u4FDD\u5B58\u7528\u6237logo\u5931\u8D25\uFF01&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>errorResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4-4\u3001\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#_1-4-4\u3001\u6D4B\u8BD5" aria-hidden="true">#</a> 1.4.4\u3001\u6D4B\u8BD5</h4><p><img src="`+j+'" alt="1564544823149"></p><p><img src="'+U+'" alt="1564544871515"></p><p><img src="'+M+`" alt="1564544931311"></p><p>\u56FE\u7247\u4E0A\u4F20\u8D85\u8FC71MB\u51FA\u9519\u7684\u89E3\u51B3\u65B9\u6848\uFF1A</p><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">#\u5728application.properties\u6587\u4EF6\u4E2D\uFF0C\u586B\u5165\u4E0B\u9762\u7684\u914D\u7F6E</span>
<span class="token comment">#\u8BBE\u7F6E\u6700\u5927\u7684\u6587\u4EF6\u4E0A\u4F20\u5927\u5C0F</span>
<span class="token key attr-name">spring.servlet.multipart.max-request-size</span><span class="token punctuation">=</span><span class="token value attr-value">30MB</span>
<span class="token key attr-name">spring.servlet.multipart.max-file-size</span><span class="token punctuation">=</span><span class="token value attr-value">30MB</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2\u3001\u6821\u9A8Ctoken" tabindex="-1"><a class="header-anchor" href="#_2\u3001\u6821\u9A8Ctoken" aria-hidden="true">#</a> 2\u3001\u6821\u9A8Ctoken</h2><p>\u5728\u6574\u4E2A\u7CFB\u7EDF\u67B6\u6784\u4E2D\uFF0C\u53EA\u6709SSO\u4FDD\u5B58\u4E86JWT\u4E2D\u7684\u79D8\u94A5\uFF0C\u6240\u4EE5\u53EA\u80FD\u901A\u8FC7SSO\u7CFB\u7EDF\u63D0\u4F9B\u7684\u63A5\u53E3\u670D\u52A1\u8FDB\u884C\u5BF9token\u7684\u6821\u9A8C\uFF0C\u6240\u4EE5\u5728SSO\u7CFB\u7EDF\u4E2D\uFF0C\u9700\u8981\u5BF9\u5916\u5F00\u653E\u63A5\u53E3\uFF0C\u901A\u8FC7token\u8FDB\u884C\u67E5\u8BE2\u7528\u6237\u4FE1\u606F\uFF0C\u5982\u679C\u8FD4\u56DEnull\u8BF4\u660E\u7528\u6237\u72B6\u6001\u5DF2\u8FC7\u671F\u6216\u8005\u662F\u975E\u6CD5\u7684token\uFF0C\u5426\u5219\u8FD4\u56DEUser\u5BF9\u8C61\u6570\u636E\u3002</p><h3 id="_2-1\u3001usercontroller" tabindex="-1"><a class="header-anchor" href="#_2-1\u3001usercontroller" aria-hidden="true">#</a> 2.1\u3001UserController</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token doc-comment comment">/**
     * \u6821\u9A8Ctoken\uFF0C\u6839\u636Etoken\u67E5\u8BE2\u7528\u6237\u6570\u636E
     *
     * <span class="token keyword">@param</span> <span class="token parameter">token</span>
     * <span class="token keyword">@return</span>
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;{token}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">queryUserByToken</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">queryUserByToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2\u3001userservice" tabindex="-1"><a class="header-anchor" href="#_2-2\u3001userservice" aria-hidden="true">#</a> 2.2\u3001UserService</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>	<span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">queryUserByToken</span><span class="token punctuation">(</span><span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// \u901A\u8FC7token\u89E3\u6790\u6570\u636E</span>
            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> body <span class="token operator">=</span> <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token function">parser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setSigningKey</span><span class="token punctuation">(</span>secret<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">parseClaimsJws</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>body<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//\u9700\u8981\u8FD4\u56DEuser\u5BF9\u8C61\u4E2D\u7684mobile\uFF0C\u9700\u8981\u67E5\u8BE2\u6570\u636E\u5E93\u83B7\u53D6\u5230mobile\u6570\u636E</span>
            <span class="token comment">//\u5982\u679C\u6BCF\u6B21\u90FD\u67E5\u8BE2\u6570\u636E\u5E93\uFF0C\u5FC5\u7136\u4F1A\u5BFC\u81F4\u6027\u80FD\u95EE\u9898\uFF0C\u9700\u8981\u5BF9\u7528\u6237\u7684\u624B\u673A\u53F7\u8FDB\u884C\u7F13\u5B58\u64CD\u4F5C</span>
            <span class="token comment">//\u6570\u636E\u7F13\u5B58\u65F6\uFF0C\u9700\u8981\u8BBE\u7F6E\u8FC7\u671F\u65F6\u95F4\uFF0C\u8FC7\u671F\u65F6\u95F4\u8981\u4E0Etoken\u7684\u65F6\u95F4\u4E00\u81F4</span>
            <span class="token comment">//\u5982\u679C\u7528\u6237\u4FEE\u6539\u4E86\u624B\u673A\u53F7\uFF0C\u9700\u8981\u540C\u6B65\u4FEE\u6539redis\u4E2D\u7684\u6570\u636E</span>

            <span class="token class-name">String</span> redisKey <span class="token operator">=</span> <span class="token string">&quot;TANHUA_USER_MOBILE_&quot;</span> <span class="token operator">+</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>redisTemplate<span class="token punctuation">.</span><span class="token function">hasKey</span><span class="token punctuation">(</span>redisKey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">String</span> mobile <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>redisKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
                user<span class="token punctuation">.</span><span class="token function">setMobile</span><span class="token punctuation">(</span>mobile<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">//\u67E5\u8BE2\u6570\u636E\u5E93</span>
                <span class="token class-name">User</span> u <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>userMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                user<span class="token punctuation">.</span><span class="token function">setMobile</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span><span class="token function">getMobile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//\u5C06\u624B\u673A\u53F7\u5199\u5165\u5230redis\u4E2D</span>
                <span class="token comment">//\u5728jwt\u4E2D\u7684\u8FC7\u671F\u65F6\u95F4\u7684\u5355\u4F4D\u4E3A\uFF1A\u79D2</span>
                <span class="token keyword">long</span> timeout <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>body<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;exp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">-</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>redisKey<span class="token punctuation">,</span> u<span class="token punctuation">.</span><span class="token function">getMobile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">MILLISECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">return</span> user<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ExpiredJwtException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;token\u5DF2\u7ECF\u8FC7\u671F\uFF01 token = &quot;</span> <span class="token operator">+</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;token\u4E0D\u5408\u6CD5\uFF01 token = &quot;</span><span class="token operator">+</span> token<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3\u3001\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#_2-3\u3001\u6D4B\u8BD5" aria-hidden="true">#</a> 2.3\u3001\u6D4B\u8BD5</h3><p><img src="`+R+'" alt="image-20201123155434121"></p><p>\u6570\u636E\u5DF2\u7ECF\u5B58\u50A8\u5230redis\u4E2D\uFF1A</p><p><img src="'+P+`" alt="image-20201123162229283"></p><h2 id="_3\u3001mongodb\u5FEB\u901F\u5165\u95E8" tabindex="-1"><a class="header-anchor" href="#_3\u3001mongodb\u5FEB\u901F\u5165\u95E8" aria-hidden="true">#</a> 3\u3001MongoDB\u5FEB\u901F\u5165\u95E8</h2><h3 id="_3-1\u3001mongodb\u7B80\u4ECB" tabindex="-1"><a class="header-anchor" href="#_3-1\u3001mongodb\u7B80\u4ECB" aria-hidden="true">#</a> 3.1\u3001MongoDB\u7B80\u4ECB</h3><p>MongoDB\u662F\u4E00\u4E2A\u57FA\u4E8E\u5206\u5E03\u5F0F\u6587\u4EF6\u5B58\u50A8\u7684\u6570\u636E\u5E93\u3002\u7531C++\u8BED\u8A00\u7F16\u5199\u3002\u65E8\u5728\u4E3AWEB\u5E94\u7528\u63D0\u4F9B\u53EF\u6269\u5C55\u7684\u9AD8\u6027\u80FD\u6570\u636E\u5B58\u50A8\u89E3\u51B3\u65B9\u6848\u3002</p><p>MongoDB\u662F\u4E00\u4E2A\u4ECB\u4E8E\u5173\u7CFB\u6570\u636E\u5E93\u548C\u975E\u5173\u7CFB\u6570\u636E\u5E93\u4E4B\u95F4\u7684\u4EA7\u54C1\uFF0C\u662F\u975E\u5173\u7CFB\u6570\u636E\u5E93\u5F53\u4E2D\u529F\u80FD\u6700\u4E30\u5BCC\uFF0C\u6700\u50CF\u5173\u7CFB\u6570\u636E\u5E93\u7684\uFF0C\u5B83\u652F\u6301\u7684\u6570\u636E\u7ED3\u6784\u975E\u5E38\u677E\u6563\uFF0C\u662F\u7C7B\u4F3Cjson\u7684bson\u683C\u5F0F\uFF0C\u56E0\u6B64\u53EF\u4EE5\u5B58\u50A8\u6BD4\u8F83\u590D\u6742\u7684\u6570\u636E\u7C7B\u578B\u3002</p><p>MongoDB\u6700\u5927\u7684\u7279\u70B9\u662F\u5B83\u652F\u6301\u7684\u67E5\u8BE2\u8BED\u8A00\u975E\u5E38\u5F3A\u5927\uFF0C\u5176\u8BED\u6CD5\u6709\u70B9\u7C7B\u4F3C\u4E8E\u9762\u5411\u5BF9\u8C61\u7684\u67E5\u8BE2\u8BED\u8A00\uFF0C\u51E0\u4E4E\u53EF\u4EE5\u5B9E\u73B0\u7C7B\u4F3C\u5173\u7CFB\u6570\u636E\u5E93\u5355\u8868\u67E5\u8BE2\u7684\u7EDD\u5927\u90E8\u5206\u529F\u80FD\uFF0C\u800C\u4E14\u8FD8\u652F\u6301\u5BF9\u6570\u636E\u5EFA\u7ACB\u7D22\u5F15\u3002</p><p>\u5B98\u7F51\uFF1Ahttps://www.mongodb.com</p><h3 id="_3-2\u3001\u901A\u8FC7docker\u5B89\u88C5mongodb" tabindex="-1"><a class="header-anchor" href="#_3-2\u3001\u901A\u8FC7docker\u5B89\u88C5mongodb" aria-hidden="true">#</a> 3.2\u3001\u901A\u8FC7docker\u5B89\u88C5MongoDB</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#\u62C9\u53D6\u955C\u50CF</span>
<span class="token function">docker</span> pull mongo:4.0.3

<span class="token comment">#\u521B\u5EFA\u5BB9\u5668</span>
<span class="token function">docker</span> create <span class="token parameter variable">--name</span> mongodb-server <span class="token parameter variable">-p</span> <span class="token number">27018</span>:27017 <span class="token parameter variable">-v</span> mongodb-data:/data/db mongo:4.0.3 <span class="token parameter variable">--auth</span>

<span class="token comment">#\u542F\u52A8\u5BB9\u5668</span>
<span class="token function">docker</span> start mongodb-server

<span class="token comment">#\u8FDB\u5165\u5BB9\u5668</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> mongodb-server /bin/bash


<span class="token comment">#\u8FDB\u5165admin\u6570\u636E\u5E93</span>
mongo
use admin

<span class="token comment">#\u6DFB\u52A0\u7BA1\u7406\u5458\uFF0C\u5176\u62E5\u6709\u7BA1\u7406\u7528\u6237\u548C\u89D2\u8272\u7684\u6743\u9650</span>
db.createUser<span class="token punctuation">(</span><span class="token punctuation">{</span> user: <span class="token string">&#39;root&#39;</span>, pwd: <span class="token string">&#39;root&#39;</span>, roles: <span class="token punctuation">[</span> <span class="token punctuation">{</span> role: <span class="token string">&quot;root&quot;</span>, db: <span class="token string">&quot;admin&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">#\u6D4B\u8BD5\uFF0C\u53D1\u73B0\u662F\u6CA1\u6709\u6743\u9650\u64CD\u4F5C\u7684</span>
<span class="token operator">&gt;</span> show dbs
<span class="token number">2020</span>-10-20T09:09:15.543+0000 E QUERY    <span class="token punctuation">[</span>js<span class="token punctuation">]</span> Error: listDatabases failed:<span class="token punctuation">{</span>
        <span class="token string">&quot;ok&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
        <span class="token string">&quot;errmsg&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;command listDatabases requires authentication&quot;</span>,
        <span class="token string">&quot;code&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">13</span>,
        <span class="token string">&quot;codeName&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;Unauthorized&quot;</span>
<span class="token punctuation">}</span> <span class="token builtin class-name">:</span>

<span class="token comment">#\u8FDB\u884C\u8BA4\u8BC1</span>
mongo <span class="token parameter variable">-u</span> <span class="token string">&quot;root&quot;</span> <span class="token parameter variable">-p</span> <span class="token string">&quot;root&quot;</span> <span class="token parameter variable">--authenticationDatabase</span> <span class="token string">&quot;admin&quot;</span>

<span class="token comment">#\u901A\u8FC7admin\u6DFB\u52A0\u666E\u901A\u7528\u6237</span>
use admin
db.createUser<span class="token punctuation">(</span><span class="token punctuation">{</span> user: <span class="token string">&#39;tanhua&#39;</span>, pwd: <span class="token string">&#39;l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV&#39;</span>, roles: <span class="token punctuation">[</span> <span class="token punctuation">{</span> role: <span class="token string">&quot;readWrite&quot;</span>, db: <span class="token string">&quot;tanhua&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#\u901A\u8FC7tanhua\u7528\u6237\u767B\u5F55\u8FDB\u884C\u6D4B\u8BD5</span>
mongo <span class="token parameter variable">-u</span> <span class="token string">&quot;tanhua&quot;</span> <span class="token parameter variable">-p</span> <span class="token string">&quot;l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV&quot;</span> <span class="token parameter variable">--authenticationDatabase</span> <span class="token string">&quot;admin&quot;</span>

<span class="token comment">#\u6D4B\u8BD5</span>
root@5d848955ff7e:/<span class="token comment"># mongo -u &quot;tanhua&quot; -p &quot;tanhua123&quot; --authenticationDatabase &quot;admin&quot;</span>
MongoDB shell version v4.0.3
connecting to: mongodb://127.0.0.1:27017
Implicit session: session <span class="token punctuation">{</span> <span class="token string">&quot;id&quot;</span> <span class="token builtin class-name">:</span> UUID<span class="token punctuation">(</span><span class="token string">&quot;6c368269-30f0-4b29-a224-05a38b5847e2&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
MongoDB server version: <span class="token number">4.0</span>.3
<span class="token operator">&gt;</span> use tanhua
switched to db tanhua
<span class="token operator">&gt;</span> db.user.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>id:1,username:<span class="token string">&#39;zhangsan&#39;</span>,age:20<span class="token punctuation">}</span><span class="token punctuation">)</span>
WriteResult<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;nInserted&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> db.user.<span class="token function-name function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;5f8eb2726e0de0aa9517afd3&quot;</span><span class="token punctuation">)</span>, <span class="token string">&quot;id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">&quot;username&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;zhangsan&quot;</span>, <span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">20</span> <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3\u3001mongodb\u57FA\u672C\u64CD\u4F5C" tabindex="-1"><a class="header-anchor" href="#_3-3\u3001mongodb\u57FA\u672C\u64CD\u4F5C" aria-hidden="true">#</a> 3.3\u3001MongoDB\u57FA\u672C\u64CD\u4F5C</h3><h4 id="_3-3-1\u3001\u57FA\u672C\u6982\u5FF5" tabindex="-1"><a class="header-anchor" href="#_3-3-1\u3001\u57FA\u672C\u6982\u5FF5" aria-hidden="true">#</a> 3.3.1\u3001\u57FA\u672C\u6982\u5FF5</h4><p>\u4E3A\u4E86\u66F4\u597D\u7684\u7406\u89E3\uFF0C\u4E0B\u9762\u4E0ESQL\u4E2D\u7684\u6982\u5FF5\u8FDB\u884C\u5BF9\u6BD4\uFF1A</p><table><thead><tr><th>SQL\u672F\u8BED/\u6982\u5FF5</th><th>MongoDB\u672F\u8BED/\u6982\u5FF5</th><th>\u89E3\u91CA/\u8BF4\u660E</th></tr></thead><tbody><tr><td>database</td><td>database</td><td>\u6570\u636E\u5E93</td></tr><tr><td>table</td><td>collection</td><td>\u6570\u636E\u5E93\u8868/\u96C6\u5408</td></tr><tr><td>row</td><td>document</td><td>\u6570\u636E\u8BB0\u5F55\u884C/\u6587\u6863</td></tr><tr><td>column</td><td>field</td><td>\u6570\u636E\u5B57\u6BB5/\u57DF</td></tr><tr><td>index</td><td>index</td><td>\u7D22\u5F15</td></tr><tr><td>table joins</td><td></td><td>\u8868\u8FDE\u63A5,MongoDB\u4E0D\u652F\u6301</td></tr><tr><td>primary key</td><td>primary key</td><td>\u4E3B\u952E,MongoDB\u81EA\u52A8\u5C06_id\u5B57\u6BB5\u8BBE\u7F6E\u4E3A\u4E3B\u952E</td></tr></tbody></table><p><img src="`+C+`" alt="img"></p><h4 id="_3-3-2\u3001\u6570\u636E\u5E93\u4EE5\u53CA\u8868\u7684\u64CD\u4F5C" tabindex="-1"><a class="header-anchor" href="#_3-3-2\u3001\u6570\u636E\u5E93\u4EE5\u53CA\u8868\u7684\u64CD\u4F5C" aria-hidden="true">#</a> 3.3.2\u3001\u6570\u636E\u5E93\u4EE5\u53CA\u8868\u7684\u64CD\u4F5C</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#\u67E5\u770B\u6240\u6709\u7684\u6570\u636E\u5E93</span>
<span class="token operator">&gt;</span> show dbs
admin   <span class="token number">0</span>.000GB
config  <span class="token number">0</span>.000GB
<span class="token builtin class-name">local</span>   <span class="token number">0</span>.000GB

<span class="token comment">#\u901A\u8FC7use\u5173\u952E\u5B57\u5207\u6362\u6570\u636E\u5E93</span>
<span class="token operator">&gt;</span> use admin
switched to db admin

<span class="token comment">#\u521B\u5EFA\u6570\u636E\u5E93</span>
<span class="token comment">#\u8BF4\u660E\uFF1A\u5728MongoDB\u4E2D\uFF0C\u6570\u636E\u5E93\u662F\u81EA\u52A8\u521B\u5EFA\u7684\uFF0C\u901A\u8FC7use\u5207\u6362\u5230\u65B0\u6570\u636E\u5E93\u4E2D\uFF0C\u8FDB\u884C\u63D2\u5165\u6570\u636E\u5373\u53EF\u81EA\u52A8\u521B\u5EFA\u6570\u636E\u5E93</span>
<span class="token operator">&gt;</span> use testdb
switched to db testdb
<span class="token operator">&gt;</span> show dbs <span class="token comment">#\u5E76\u6CA1\u6709\u521B\u5EFA\u6570\u636E\u5E93</span>
admin   <span class="token number">0</span>.000GB
config  <span class="token number">0</span>.000GB
<span class="token builtin class-name">local</span>   <span class="token number">0</span>.000GB
<span class="token operator">&gt;</span> db.user.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>id:1,name:<span class="token string">&#39;zhangsan&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">#\u63D2\u5165\u6570\u636E</span>
WriteResult<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;nInserted&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> show dbs
admin   <span class="token number">0</span>.000GB
config  <span class="token number">0</span>.000GB
<span class="token builtin class-name">local</span>   <span class="token number">0</span>.000GB
testdb  <span class="token number">0</span>.000GB <span class="token comment">#\u6570\u636E\u5E93\u81EA\u52A8\u521B\u5EFA</span>

<span class="token comment">#\u67E5\u770B\u8868</span>
<span class="token operator">&gt;</span> show tables
user
<span class="token operator">&gt;</span> show collections
user
<span class="token operator">&gt;</span> 

<span class="token comment">#\u5220\u9664\u96C6\u5408\uFF08\u8868\uFF09</span>
<span class="token operator">&gt;</span> db.user.drop<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token boolean">true</span>  <span class="token comment">#\u5982\u679C\u6210\u529F\u5220\u9664\u9009\u5B9A\u96C6\u5408\uFF0C\u5219 drop() \u65B9\u6CD5\u8FD4\u56DE true\uFF0C\u5426\u5219\u8FD4\u56DE false\u3002</span>

<span class="token comment">#\u5220\u9664\u6570\u636E\u5E93</span>
<span class="token operator">&gt;</span> use testdb <span class="token comment">#\u5148\u5207\u6362\u5230\u8981\u5220\u9664\u7684\u6570\u636E\u5E93\u4E2D</span>
switched to db testdb
<span class="token operator">&gt;</span> db.dropDatabase<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#\u5220\u9664\u6570\u636E\u5E93</span>
<span class="token punctuation">{</span> <span class="token string">&quot;dropped&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;testdb&quot;</span>, <span class="token string">&quot;ok&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token operator">&gt;</span> show dbs
admin   <span class="token number">0</span>.000GB
config  <span class="token number">0</span>.000GB
<span class="token builtin class-name">local</span>   <span class="token number">0</span>.000GB
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-3\u3001\u65B0\u589E\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_3-3-3\u3001\u65B0\u589E\u6570\u636E" aria-hidden="true">#</a> 3.3.3\u3001\u65B0\u589E\u6570\u636E</h4><p>\u5728MongoDB\u4E2D\uFF0C\u5B58\u50A8\u7684\u6587\u6863\u7ED3\u6784\u662F\u4E00\u79CD\u7C7B\u4F3C\u4E8Ejson\u7684\u7ED3\u6784\uFF0C\u79F0\u4E4B\u4E3Abson\uFF08\u5168\u79F0\u4E3A\uFF1ABinary JSON\uFF09\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#\u63D2\u5165\u6570\u636E</span>

<span class="token comment">#\u8BED\u6CD5\uFF1Adb.COLLECTION_NAME.insert(document)</span>
<span class="token operator">&gt;</span> db.user.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>id:1,username:<span class="token string">&#39;zhangsan&#39;</span>,age:20<span class="token punctuation">}</span><span class="token punctuation">)</span>
WriteResult<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;nInserted&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> db.user.save<span class="token punctuation">(</span><span class="token punctuation">{</span>id:2,username:<span class="token string">&#39;lisi&#39;</span>,age:25<span class="token punctuation">}</span><span class="token punctuation">)</span>
WriteResult<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;nInserted&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> db.user.find<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#\u67E5\u8BE2\u6570\u636E</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;5c08c0024b318926e0c1f6dc&quot;</span><span class="token punctuation">)</span>, <span class="token string">&quot;id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">&quot;username&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;zhangsan&quot;</span>, <span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">20</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;5c08c0134b318926e0c1f6dd&quot;</span><span class="token punctuation">)</span>, <span class="token string">&quot;id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>, <span class="token string">&quot;username&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;lisi&quot;</span>, <span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">25</span> <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-4\u3001\u66F4\u65B0\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_3-3-4\u3001\u66F4\u65B0\u6570\u636E" aria-hidden="true">#</a> 3.3.4\u3001\u66F4\u65B0\u6570\u636E</h4><p>update() \u65B9\u6CD5\u7528\u4E8E\u66F4\u65B0\u5DF2\u5B58\u5728\u7684\u6587\u6863\u3002\u8BED\u6CD5\u683C\u5F0F\u5982\u4E0B\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>db.collection.update<span class="token punctuation">(</span>
   <span class="token operator">&lt;</span>query<span class="token operator">&gt;</span>,
   <span class="token operator">&lt;</span>update<span class="token operator">&gt;</span>,
   <span class="token punctuation">[</span>
     upsert: <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span>,
     multi: <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span>,
     writeConcern: <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span>
   <span class="token punctuation">]</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u53C2\u6570\u8BF4\u660E\uFF1A</strong></p><ul><li><strong>query</strong> : update\u7684\u67E5\u8BE2\u6761\u4EF6\uFF0C\u7C7B\u4F3Csql update\u67E5\u8BE2\u5185where\u540E\u9762\u7684\u3002</li><li><strong>update</strong> : update\u7684\u5BF9\u8C61\u548C\u4E00\u4E9B\u66F4\u65B0\u7684\u64CD\u4F5C\u7B26\uFF08\u5982$,$inc...\uFF09\u7B49\uFF0C\u4E5F\u53EF\u4EE5\u7406\u89E3\u4E3Asql update\u67E5\u8BE2\u5185set\u540E\u9762\u7684</li><li><strong>upsert</strong> : \u53EF\u9009\uFF0C\u8FD9\u4E2A\u53C2\u6570\u7684\u610F\u601D\u662F\uFF0C\u5982\u679C\u4E0D\u5B58\u5728update\u7684\u8BB0\u5F55\uFF0C\u662F\u5426\u63D2\u5165objNew,true\u4E3A\u63D2\u5165\uFF0C\u9ED8\u8BA4\u662Ffalse\uFF0C\u4E0D\u63D2\u5165\u3002</li><li><strong>multi</strong> : \u53EF\u9009\uFF0Cmongodb \u9ED8\u8BA4\u662Ffalse,\u53EA\u66F4\u65B0\u627E\u5230\u7684\u7B2C\u4E00\u6761\u8BB0\u5F55\uFF0C\u5982\u679C\u8FD9\u4E2A\u53C2\u6570\u4E3Atrue,\u5C31\u628A\u6309\u6761\u4EF6\u67E5\u51FA\u6765\u591A\u6761\u8BB0\u5F55\u5168\u90E8\u66F4\u65B0\u3002</li><li><strong>writeConcern</strong> :\u53EF\u9009\uFF0C\u629B\u51FA\u5F02\u5E38\u7684\u7EA7\u522B\u3002</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&gt;</span> db.user.<span class="token function-name function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;5c08c0024b318926e0c1f6dc&quot;</span><span class="token punctuation">)</span>, <span class="token string">&quot;id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">&quot;username&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;zhangsan&quot;</span>, <span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">20</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;5c08c0134b318926e0c1f6dd&quot;</span><span class="token punctuation">)</span>, <span class="token string">&quot;id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>, <span class="token string">&quot;username&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;lisi&quot;</span>, <span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">25</span> <span class="token punctuation">}</span>

<span class="token operator">&gt;</span> db.user.update<span class="token punctuation">(</span><span class="token punctuation">{</span>id:1<span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token variable">$set</span>:<span class="token punctuation">{</span>age:22<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">#\u66F4\u65B0\u6570\u636E</span>

WriteResult<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;nMatched&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">&quot;nUpserted&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token string">&quot;nModified&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token operator">&gt;</span> db.user.<span class="token function-name function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;5c08c0024b318926e0c1f6dc&quot;</span><span class="token punctuation">)</span>, <span class="token string">&quot;id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">&quot;username&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;zhangsan&quot;</span>, <span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">22</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;5c08c0134b318926e0c1f6dd&quot;</span><span class="token punctuation">)</span>, <span class="token string">&quot;id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>, <span class="token string">&quot;username&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;lisi&quot;</span>, <span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">25</span> <span class="token punctuation">}</span>

<span class="token comment">#\u6CE8\u610F\uFF1A\u5982\u679C\u8FD9\u6837\u5199\uFF0C\u4F1A\u5220\u9664\u6389\u5176\u4ED6\u7684\u5B57\u6BB5</span>
<span class="token operator">&gt;</span> db.user.update<span class="token punctuation">(</span><span class="token punctuation">{</span>id:1<span class="token punctuation">}</span>,<span class="token punctuation">{</span>age:25<span class="token punctuation">}</span><span class="token punctuation">)</span>
WriteResult<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;nMatched&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">&quot;nUpserted&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token string">&quot;nModified&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> db.user.<span class="token function-name function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;5c08c0024b318926e0c1f6dc&quot;</span><span class="token punctuation">)</span>, <span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">25</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;5c08c0134b318926e0c1f6dd&quot;</span><span class="token punctuation">)</span>, <span class="token string">&quot;id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>, <span class="token string">&quot;username&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;lisi&quot;</span>, <span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">25</span> <span class="token punctuation">}</span>

<span class="token comment">#\u66F4\u65B0\u4E0D\u5B58\u5728\u7684\u5B57\u6BB5\uFF0C\u4F1A\u65B0\u589E\u5B57\u6BB5</span>
<span class="token operator">&gt;</span> db.user.update<span class="token punctuation">(</span><span class="token punctuation">{</span>id:2<span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token variable">$set</span>:<span class="token punctuation">{</span>sex:1<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">#\u66F4\u65B0\u6570\u636E</span>
<span class="token operator">&gt;</span> db.user.<span class="token function-name function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;5c08c0024b318926e0c1f6dc&quot;</span><span class="token punctuation">)</span>, <span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">25</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;5c08c0134b318926e0c1f6dd&quot;</span><span class="token punctuation">)</span>, <span class="token string">&quot;id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>, <span class="token string">&quot;username&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;lisi&quot;</span>, <span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">25</span>, <span class="token string">&quot;sex&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>

<span class="token comment">#\u66F4\u65B0\u4E0D\u5B58\u5728\u7684\u6570\u636E\uFF0C\u9ED8\u8BA4\u4E0D\u4F1A\u65B0\u589E\u6570\u636E</span>
<span class="token operator">&gt;</span> db.user.update<span class="token punctuation">(</span><span class="token punctuation">{</span>id:3<span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token variable">$set</span>:<span class="token punctuation">{</span>sex:1<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
WriteResult<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;nMatched&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token string">&quot;nUpserted&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token string">&quot;nModified&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> db.user.<span class="token function-name function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;5c08c0024b318926e0c1f6dc&quot;</span><span class="token punctuation">)</span>, <span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">25</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;5c08c0134b318926e0c1f6dd&quot;</span><span class="token punctuation">)</span>, <span class="token string">&quot;id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>, <span class="token string">&quot;username&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;lisi&quot;</span>, <span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">25</span>, <span class="token string">&quot;sex&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>

<span class="token comment">#\u5982\u679C\u8BBE\u7F6E\u7B2C\u4E00\u4E2A\u53C2\u6570\u4E3Atrue\uFF0C\u5C31\u662F\u65B0\u589E\u6570\u636E</span>
<span class="token operator">&gt;</span> db.user.update<span class="token punctuation">(</span><span class="token punctuation">{</span>id:3<span class="token punctuation">}</span>,<span class="token punctuation">{</span><span class="token variable">$set</span>:<span class="token punctuation">{</span>sex:1<span class="token punctuation">}</span><span class="token punctuation">}</span>,true<span class="token punctuation">)</span>
WriteResult<span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token string">&quot;nMatched&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
	<span class="token string">&quot;nUpserted&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
	<span class="token string">&quot;nModified&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">0</span>,
	<span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;5c08cb281418d073246bc642&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> db.user.<span class="token function-name function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;5c08c0024b318926e0c1f6dc&quot;</span><span class="token punctuation">)</span>, <span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">25</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;5c08c0134b318926e0c1f6dd&quot;</span><span class="token punctuation">)</span>, <span class="token string">&quot;id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>, <span class="token string">&quot;username&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;lisi&quot;</span>, <span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">25</span>, <span class="token string">&quot;sex&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> ObjectId<span class="token punctuation">(</span><span class="token string">&quot;5c08cb281418d073246bc642&quot;</span><span class="token punctuation">)</span>, <span class="token string">&quot;id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">3</span>, <span class="token string">&quot;sex&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-5\u3001\u5220\u9664\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_3-3-5\u3001\u5220\u9664\u6570\u636E" aria-hidden="true">#</a> 3.3.5\u3001\u5220\u9664\u6570\u636E</h4><p>\u901A\u8FC7remove()\u65B9\u6CD5\u8FDB\u884C\u5220\u9664\u6570\u636E\uFF0C\u8BED\u6CD5\u5982\u4E0B\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>db.collection.remove<span class="token punctuation">(</span>
   <span class="token operator">&lt;</span>query<span class="token operator">&gt;</span>,
   <span class="token punctuation">{</span>
     justOne: <span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span>,
     writeConcern: <span class="token operator">&lt;</span>document<span class="token operator">&gt;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u53C2\u6570\u8BF4\u660E\uFF1A</strong></p><ul><li><strong>query</strong> :\uFF08\u53EF\u9009\uFF09\u5220\u9664\u7684\u6587\u6863\u7684\u6761\u4EF6\u3002</li><li><strong>justOne</strong> : \uFF08\u53EF\u9009\uFF09\u5982\u679C\u8BBE\u4E3A true \u6216 1\uFF0C\u5219\u53EA\u5220\u9664\u4E00\u4E2A\u6587\u6863\uFF0C\u5982\u679C\u4E0D\u8BBE\u7F6E\u8BE5\u53C2\u6570\uFF0C\u6216\u4F7F\u7528\u9ED8\u8BA4\u503C false\uFF0C\u5219\u5220\u9664\u6240\u6709\u5339\u914D\u6761\u4EF6\u7684\u6587\u6863\u3002</li><li><strong>writeConcern</strong> :\uFF08\u53EF\u9009\uFF09\u629B\u51FA\u5F02\u5E38\u7684\u7EA7\u522B\u3002</li></ul><p>\u5B9E\u4F8B\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token operator">&gt;</span> db.user.remove<span class="token punctuation">(</span><span class="token punctuation">{</span>age:25<span class="token punctuation">}</span><span class="token punctuation">)</span>
WriteResult<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;nRemoved&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">#\u5220\u9664\u4E862\u6761\u6570\u636E</span>

<span class="token comment">#\u63D2\u51654\u6761\u6D4B\u8BD5\u6570\u636E</span>
db.user.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>id:1,username:<span class="token string">&#39;zhangsan&#39;</span>,age:20<span class="token punctuation">}</span><span class="token punctuation">)</span>
db.user.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>id:2,username:<span class="token string">&#39;lisi&#39;</span>,age:21<span class="token punctuation">}</span><span class="token punctuation">)</span>
db.user.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>id:3,username:<span class="token string">&#39;wangwu&#39;</span>,age:22<span class="token punctuation">}</span><span class="token punctuation">)</span>
db.user.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>id:4,username:<span class="token string">&#39;zhaoliu&#39;</span>,age:22<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token operator">&gt;</span> db.user.remove<span class="token punctuation">(</span><span class="token punctuation">{</span>age:22<span class="token punctuation">}</span>,true<span class="token punctuation">)</span>
WriteResult<span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">&quot;nRemoved&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">#\u5220\u9664\u4E861\u6761\u6570\u636E</span>

<span class="token comment">#\u5220\u9664\u6240\u6709\u6570\u636E</span>
<span class="token operator">&gt;</span> db.user.remove<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">#\u8BF4\u660E\uFF1A\u4E3A\u4E86\u7B80\u5316\u64CD\u4F5C\uFF0C\u5B98\u65B9\u63A8\u8350\u4F7F\u7528deleteOne()\u4E0EdeleteMany()\u8FDB\u884C\u5220\u9664\u6570\u636E\u64CD\u4F5C\u3002</span>
db.user.deleteOne<span class="token punctuation">(</span><span class="token punctuation">{</span>id:1<span class="token punctuation">}</span><span class="token punctuation">)</span>
db.user.deleteMany<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">#\u5220\u9664\u6240\u6709\u6570\u636E</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-3-6\u3001\u67E5\u8BE2\u6570\u636E" tabindex="-1"><a class="header-anchor" href="#_3-3-6\u3001\u67E5\u8BE2\u6570\u636E" aria-hidden="true">#</a> 3.3.6\u3001\u67E5\u8BE2\u6570\u636E</h4><p>MongoDB \u67E5\u8BE2\u6570\u636E\u7684\u8BED\u6CD5\u683C\u5F0F\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>db.user.find([query],[fields])
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><strong>query</strong> \uFF1A\u53EF\u9009\uFF0C\u4F7F\u7528\u67E5\u8BE2\u64CD\u4F5C\u7B26\u6307\u5B9A\u67E5\u8BE2\u6761\u4EF6</li><li><strong>fields</strong> \uFF1A\u53EF\u9009\uFF0C\u4F7F\u7528\u6295\u5F71\u64CD\u4F5C\u7B26\u6307\u5B9A\u8FD4\u56DE\u7684\u952E\u3002\u67E5\u8BE2\u65F6\u8FD4\u56DE\u6587\u6863\u4E2D\u6240\u6709\u952E\u503C\uFF0C \u53EA\u9700\u7701\u7565\u8BE5\u53C2\u6570\u5373\u53EF\uFF08\u9ED8\u8BA4\u7701\u7565\uFF09\u3002</li></ul><p>\u5982\u679C\u4F60\u9700\u8981\u4EE5\u6613\u8BFB\u7684\u65B9\u5F0F\u6765\u8BFB\u53D6\u6570\u636E\uFF0C\u53EF\u4EE5\u4F7F\u7528 pretty() \u65B9\u6CD5\uFF0C\u8BED\u6CD5\u683C\u5F0F\u5982\u4E0B\uFF1A</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>&gt;db.col.find().pretty()
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>pretty() \u65B9\u6CD5\u4EE5\u683C\u5F0F\u5316\u7684\u65B9\u5F0F\u6765\u663E\u793A\u6240\u6709\u6587\u6863\u3002</p><p>\u6761\u4EF6\u67E5\u8BE2\uFF1A</p><table><thead><tr><th>\u64CD\u4F5C</th><th>\u683C\u5F0F</th><th>\u8303\u4F8B</th><th>RDBMS\u4E2D\u7684\u7C7B\u4F3C\u8BED\u53E5</th></tr></thead><tbody><tr><td>\u7B49\u4E8E</td><td><code>{&lt;key&gt;:&lt;value&gt;</code>}</td><td><code>db.col.find({&quot;by&quot;:&quot;\u9ED1\u9A6C\u7A0B\u5E8F\u5458&quot;}).pretty()</code></td><td><code>where by = &#39;\u9ED1\u9A6C\u7A0B\u5E8F\u5458&#39;</code></td></tr><tr><td>\u5C0F\u4E8E</td><td><code>{&lt;key&gt;:{$lt:&lt;value&gt;}}</code></td><td><code>db.col.find({&quot;likes&quot;:{$lt:50}}).pretty()</code></td><td><code>where likes &lt; 50</code></td></tr><tr><td>\u5C0F\u4E8E\u6216\u7B49\u4E8E</td><td><code>{&lt;key&gt;:{$lte:&lt;value&gt;}}</code></td><td><code>db.col.find({&quot;likes&quot;:{$lte:50}}).pretty()</code></td><td><code>where likes &lt;= 50</code></td></tr><tr><td>\u5927\u4E8E</td><td><code>{&lt;key&gt;:{$gt:&lt;value&gt;}}</code></td><td><code>db.col.find({&quot;likes&quot;:{$gt:50}}).pretty()</code></td><td><code>where likes &gt; 50</code></td></tr><tr><td>\u5927\u4E8E\u6216\u7B49\u4E8E</td><td><code>{&lt;key&gt;:{$gte:&lt;value&gt;}}</code></td><td><code>db.col.find({&quot;likes&quot;:{$gte:50}}).pretty()</code></td><td><code>where likes &gt;= 50</code></td></tr><tr><td>\u4E0D\u7B49\u4E8E</td><td><code>{&lt;key&gt;:{$ne:&lt;value&gt;}}</code></td><td><code>db.col.find({&quot;likes&quot;:{$ne:50}}).pretty()</code></td><td><code>where likes != 50</code></td></tr></tbody></table><p>\u5B9E\u4F8B\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#\u63D2\u5165\u6D4B\u8BD5\u6570\u636E</span>
db.user.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>id:1,username:<span class="token string">&#39;zhangsan&#39;</span>,age:20<span class="token punctuation">}</span><span class="token punctuation">)</span>
db.user.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>id:2,username:<span class="token string">&#39;lisi&#39;</span>,age:21<span class="token punctuation">}</span><span class="token punctuation">)</span>
db.user.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>id:3,username:<span class="token string">&#39;wangwu&#39;</span>,age:22<span class="token punctuation">}</span><span class="token punctuation">)</span>
db.user.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>id:4,username:<span class="token string">&#39;zhaoliu&#39;</span>,age:22<span class="token punctuation">}</span><span class="token punctuation">)</span>

db.user.find<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#\u67E5\u8BE2\u5168\u90E8\u6570\u636E</span>
db.user.find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span>,<span class="token punctuation">{</span>id:1,username:1<span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">#\u53EA\u67E5\u8BE2id\u4E0Eusername\u5B57\u6BB5</span>
db.user.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.count<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">#\u67E5\u8BE2\u6570\u636E\u6761\u6570</span>
db.user.find<span class="token punctuation">(</span><span class="token punctuation">{</span>id:1<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">#\u67E5\u8BE2id\u4E3A1\u7684\u6570\u636E</span>
db.user.find<span class="token punctuation">(</span><span class="token punctuation">{</span>age:<span class="token punctuation">{</span><span class="token variable">$lte</span>:21<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">#\u67E5\u8BE2\u5C0F\u4E8E\u7B49\u4E8E21\u7684\u6570\u636E</span>
db.user.find<span class="token punctuation">(</span><span class="token punctuation">{</span>age:<span class="token punctuation">{</span><span class="token variable">$lte</span>:21<span class="token punctuation">}</span>, id:<span class="token punctuation">{</span><span class="token variable">$gte</span>:2<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">#and\u67E5\u8BE2\uFF0Cage\u5C0F\u4E8E\u7B49\u4E8E21\u5E76\u4E14id\u5927\u4E8E\u7B49\u4E8E2</span>
db.user.find<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token variable">$or</span>:<span class="token punctuation">[</span><span class="token punctuation">{</span>id:1<span class="token punctuation">}</span>,<span class="token punctuation">{</span>id:2<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">#\u67E5\u8BE2id=1 or id=2</span>

<span class="token comment">#\u5206\u9875\u67E5\u8BE2\uFF1ASkip()\u8DF3\u8FC7\u51E0\u6761\uFF0Climit()\u67E5\u8BE2\u6761\u6570</span>
db.user.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.limit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>.skip<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">#\u8DF3\u8FC71\u6761\u6570\u636E\uFF0C\u67E5\u8BE22\u6761\u6570\u636E</span>

db.user.find<span class="token punctuation">(</span><span class="token punctuation">)</span>.sort<span class="token punctuation">(</span><span class="token punctuation">{</span>id:-1<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">#\u6309\u7167age\u5012\u5E8F\u6392\u5E8F\uFF0C-1\u4E3A\u5012\u5E8F\uFF0C1\u4E3A\u6B63\u5E8F</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4\u3001\u7D22\u5F15" tabindex="-1"><a class="header-anchor" href="#_3-4\u3001\u7D22\u5F15" aria-hidden="true">#</a> 3.4\u3001\u7D22\u5F15</h3><p>\u7D22\u5F15\u901A\u5E38\u80FD\u591F\u6781\u5927\u7684\u63D0\u9AD8\u67E5\u8BE2\u7684\u6548\u7387\uFF0C\u5982\u679C\u6CA1\u6709\u7D22\u5F15\uFF0CMongoDB\u5728\u8BFB\u53D6\u6570\u636E\u65F6\u5FC5\u987B\u626B\u63CF\u96C6\u5408\u4E2D\u7684\u6BCF\u4E2A\u6587\u4EF6\u5E76\u9009\u53D6\u90A3\u4E9B\u7B26\u5408\u67E5\u8BE2\u6761\u4EF6\u7684\u8BB0\u5F55\u3002</p><p>\u8FD9\u79CD\u626B\u63CF\u5168\u96C6\u5408\u7684\u67E5\u8BE2\u6548\u7387\u662F\u975E\u5E38\u4F4E\u7684\uFF0C\u7279\u522B\u5728\u5904\u7406\u5927\u91CF\u7684\u6570\u636E\u65F6\uFF0C\u67E5\u8BE2\u53EF\u4EE5\u8981\u82B1\u8D39\u51E0\u5341\u79D2\u751A\u81F3\u51E0\u5206\u949F\uFF0C\u8FD9\u5BF9\u7F51\u7AD9\u7684\u6027\u80FD\u662F\u975E\u5E38\u81F4\u547D\u7684\u3002</p><p>\u7D22\u5F15\u662F\u7279\u6B8A\u7684\u6570\u636E\u7ED3\u6784\uFF0C\u7D22\u5F15\u5B58\u50A8\u5728\u4E00\u4E2A\u6613\u4E8E\u904D\u5386\u8BFB\u53D6\u7684\u6570\u636E\u96C6\u5408\u4E2D\uFF0C\u7D22\u5F15\u662F\u5BF9\u6570\u636E\u5E93\u8868\u4E2D\u4E00\u5217\u6216\u591A\u5217\u7684\u503C\u8FDB\u884C\u6392\u5E8F\u7684\u4E00\u79CD\u7ED3\u6784</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#\u67E5\u770B\u7D22\u5F15</span>
<span class="token operator">&gt;</span> db.user.getIndexes<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>
	<span class="token punctuation">{</span>
		<span class="token string">&quot;v&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,
		<span class="token string">&quot;key&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
			<span class="token string">&quot;_id&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>
		<span class="token punctuation">}</span>,
		<span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;_id_&quot;</span>,
		<span class="token string">&quot;ns&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;testdb.user&quot;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token comment">#\u8BF4\u660E\uFF1A1\u8868\u793A\u5347\u5E8F\u521B\u5EFA\u7D22\u5F15\uFF0C-1\u8868\u793A\u964D\u5E8F\u521B\u5EFA\u7D22\u5F15\u3002</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#\u521B\u5EFA\u7D22\u5F15</span>
<span class="token operator">&gt;</span> db.user.createIndex<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;age&#39;</span>:1<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token string">&quot;createdCollectionAutomatically&quot;</span> <span class="token builtin class-name">:</span> false,
	<span class="token string">&quot;numIndexesBefore&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
	<span class="token string">&quot;numIndexesAfter&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,
	<span class="token string">&quot;ok&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#\u5220\u9664\u7D22\u5F15</span>
db.user.dropIndex<span class="token punctuation">(</span><span class="token string">&quot;age_1&quot;</span><span class="token punctuation">)</span>
<span class="token comment">#\u6216\u8005\uFF0C\u5220\u9664\u9664\u4E86_id\u4E4B\u5916\u7684\u7D22\u5F15</span>
db.user.dropIndexes<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#\u521B\u5EFA\u8054\u5408\u7D22\u5F15</span>
db.user.createIndex<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&#39;age&#39;</span>:1, <span class="token string">&#39;id&#39;</span>:-1<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#\u67E5\u770B\u7D22\u5F15\u5927\u5C0F\uFF0C\u5355\u4F4D\uFF1A\u5B57\u8282</span>
db.user.totalIndexSize<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5\u3001\u6267\u884C\u8BA1\u5212" tabindex="-1"><a class="header-anchor" href="#_3-5\u3001\u6267\u884C\u8BA1\u5212" aria-hidden="true">#</a> 3.5\u3001\u6267\u884C\u8BA1\u5212</h3><p>MongoDB \u67E5\u8BE2\u5206\u6790\u53EF\u4EE5\u786E\u4FDD\u6211\u4EEC\u5EFA\u8BAE\u7684\u7D22\u5F15\u662F\u5426\u6709\u6548\uFF0C\u662F\u67E5\u8BE2\u8BED\u53E5\u6027\u80FD\u5206\u6790\u7684\u91CD\u8981\u5DE5\u5177\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#\u63D2\u51651000\u6761\u6570\u636E</span>
for<span class="token punctuation">(</span>var <span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">1000</span><span class="token punctuation">;</span>i++<span class="token punctuation">)</span>db.user.insert<span class="token punctuation">(</span><span class="token punctuation">{</span>id:100+i,username:<span class="token string">&#39;name_&#39;</span>+i,age:10+i<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#\u67E5\u770B\u6267\u884C\u8BA1\u5212</span>
<span class="token operator">&gt;</span> db.user.find<span class="token punctuation">(</span><span class="token punctuation">{</span>age:<span class="token punctuation">{</span><span class="token variable">$gt</span>:100<span class="token punctuation">}</span>,id:<span class="token punctuation">{</span><span class="token variable">$lt</span>:200<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>.<span class="token function-name function">explain</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token string">&quot;queryPlanner&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
		<span class="token string">&quot;plannerVersion&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
		<span class="token string">&quot;namespace&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;testdb.user&quot;</span>,
		<span class="token string">&quot;indexFilterSet&quot;</span> <span class="token builtin class-name">:</span> false,
		<span class="token string">&quot;parsedQuery&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
			<span class="token string">&quot;<span class="token variable">$and</span>&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
				<span class="token punctuation">{</span>
					<span class="token string">&quot;id&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
						<span class="token string">&quot;<span class="token variable">$lt</span>&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">200</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>,
				<span class="token punctuation">{</span>
					<span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
						<span class="token string">&quot;<span class="token variable">$gt</span>&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">100</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">]</span>
		<span class="token punctuation">}</span>,
		<span class="token string">&quot;winningPlan&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>  <span class="token comment">#\u6700\u4F73\u6267\u884C\u8BA1\u5212</span>
			<span class="token string">&quot;stage&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;FETCH&quot;</span>, <span class="token comment">#\u67E5\u8BE2\u65B9\u5F0F\uFF0C\u5E38\u89C1\u7684\u6709COLLSCAN/\u5168\u8868\u626B\u63CF\u3001IXSCAN/\u7D22\u5F15\u626B\u63CF\u3001FETCH/\u6839\u636E\u7D22\u5F15\u53BB\u68C0\u7D22\u6587\u6863\u3001SHARD_MERGE/\u5408\u5E76\u5206\u7247\u7ED3\u679C\u3001IDHACK/\u9488\u5BF9_id\u8FDB\u884C\u67E5\u8BE2</span>
			<span class="token string">&quot;inputStage&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
				<span class="token string">&quot;stage&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;IXSCAN&quot;</span>,
				<span class="token string">&quot;keyPattern&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
					<span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
					<span class="token string">&quot;id&quot;</span> <span class="token builtin class-name">:</span> <span class="token parameter variable">-1</span>
				<span class="token punctuation">}</span>,
				<span class="token string">&quot;indexName&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;age_1_id_-1&quot;</span>,
				<span class="token string">&quot;isMultiKey&quot;</span> <span class="token builtin class-name">:</span> false,
				<span class="token string">&quot;multiKeyPaths&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
					<span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>,
					<span class="token string">&quot;id&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
				<span class="token punctuation">}</span>,
				<span class="token string">&quot;isUnique&quot;</span> <span class="token builtin class-name">:</span> false,
				<span class="token string">&quot;isSparse&quot;</span> <span class="token builtin class-name">:</span> false,
				<span class="token string">&quot;isPartial&quot;</span> <span class="token builtin class-name">:</span> false,
				<span class="token string">&quot;indexVersion&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">2</span>,
				<span class="token string">&quot;direction&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;forward&quot;</span>,
				<span class="token string">&quot;indexBounds&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
					<span class="token string">&quot;age&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
						<span class="token string">&quot;(100.0, inf.0]&quot;</span>
					<span class="token punctuation">]</span>,
					<span class="token string">&quot;id&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
						<span class="token string">&quot;(200.0, -inf.0]&quot;</span>
					<span class="token punctuation">]</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>,
		<span class="token string">&quot;rejectedPlans&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
	<span class="token punctuation">}</span>,
	<span class="token string">&quot;serverInfo&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
		<span class="token string">&quot;host&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;c493d5ff750a&quot;</span>,
		<span class="token string">&quot;port&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">27017</span>,
		<span class="token string">&quot;version&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;4.0.3&quot;</span>,
		<span class="token string">&quot;gitVersion&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;7ea530946fa7880364d88c8d8b6026bbc9ffa48c&quot;</span>
	<span class="token punctuation">}</span>,
	<span class="token string">&quot;ok&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#\u6D4B\u8BD5\u6CA1\u6709\u4F7F\u7528\u7D22\u5F15</span>
<span class="token operator">&gt;</span> db.user.find<span class="token punctuation">(</span><span class="token punctuation">{</span>username:<span class="token string">&#39;zhangsan&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>.<span class="token function-name function">explain</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token string">&quot;queryPlanner&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
		<span class="token string">&quot;plannerVersion&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>,
		<span class="token string">&quot;namespace&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;testdb.user&quot;</span>,
		<span class="token string">&quot;indexFilterSet&quot;</span> <span class="token builtin class-name">:</span> false,
		<span class="token string">&quot;parsedQuery&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
			<span class="token string">&quot;username&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
				<span class="token string">&quot;<span class="token variable">$eq</span>&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;zhangsan&quot;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>,
		<span class="token string">&quot;winningPlan&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
			<span class="token string">&quot;stage&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;COLLSCAN&quot;</span>,  <span class="token comment">#\u5168\u8868\u626B\u63CF</span>
			<span class="token string">&quot;filter&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
				<span class="token string">&quot;username&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
					<span class="token string">&quot;<span class="token variable">$eq</span>&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;zhangsan&quot;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>,
			<span class="token string">&quot;direction&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;forward&quot;</span>
		<span class="token punctuation">}</span>,
		<span class="token string">&quot;rejectedPlans&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">[</span> <span class="token punctuation">]</span>
	<span class="token punctuation">}</span>,
	<span class="token string">&quot;serverInfo&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
		<span class="token string">&quot;host&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;c493d5ff750a&quot;</span>,
		<span class="token string">&quot;port&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">27017</span>,
		<span class="token string">&quot;version&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;4.0.3&quot;</span>,
		<span class="token string">&quot;gitVersion&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;7ea530946fa7880364d88c8d8b6026bbc9ffa48c&quot;</span>
	<span class="token punctuation">}</span>,
	<span class="token string">&quot;ok&quot;</span> <span class="token builtin class-name">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-6\u3001ui\u5BA2\u6237\u7AEF\u5DE5\u5177" tabindex="-1"><a class="header-anchor" href="#_3-6\u3001ui\u5BA2\u6237\u7AEF\u5DE5\u5177" aria-hidden="true">#</a> 3.6\u3001UI\u5BA2\u6237\u7AEF\u5DE5\u5177</h3><p>Robo 3T\u662FMongoDB\u7684\u5BA2\u6237\u7AEF\u5DE5\u5177\uFF0C\u6211\u4EEC\u53EF\u4EE5\u4F7F\u7528\u5B83\u6765\u64CD\u4F5CMongoDB\u3002</p><p><img src="`+E+'" alt="1544109001776"></p><p>\u67E5\u770B\u6570\u636E\uFF1A <img src="'+D+'" alt="1544109144162"></p><p>\u6216\u4F7F\u7528Navicat Premium 15\uFF1A</p><p><img src="'+B+`" alt="image-20201123162352921"></p><h2 id="_4\u3001springboot\u6574\u5408mongodb" tabindex="-1"><a class="header-anchor" href="#_4\u3001springboot\u6574\u5408mongodb" aria-hidden="true">#</a> 4\u3001SpringBoot\u6574\u5408MongoDB</h2><p>spring-data\u5BF9MongoDB\u505A\u4E86\u652F\u6301\uFF0C\u4F7F\u7528spring-data-mongodb\u53EF\u4EE5\u7B80\u5316MongoDB\u7684\u64CD\u4F5C\u3002</p><p>\u5730\u5740\uFF1Ahttps://spring.io/projects/spring-data-mongodb</p><h3 id="_4-1\u3001\u5BFC\u5165\u4F9D\u8D56" tabindex="-1"><a class="header-anchor" href="#_4-1\u3001\u5BFC\u5165\u4F9D\u8D56" aria-hidden="true">#</a> 4.1\u3001\u5BFC\u5165\u4F9D\u8D56</h3><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1.0.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.itcast.mongodb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>itcast-mongodb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-mongodb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.18.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- java\u7F16\u8BD1\u63D2\u4EF6 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoding</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2\u3001\u7F16\u5199application-properties\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#_4-2\u3001\u7F16\u5199application-properties\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> 4.2\u3001\u7F16\u5199application.properties\u914D\u7F6E\u6587\u4EF6</h3><div class="language-properties ext-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment"># Spring boot application</span>
<span class="token key attr-name">spring.application.name</span> <span class="token punctuation">=</span> <span class="token value attr-value">itcast-mongodb</span>

<span class="token comment">#\u65E0\u8BA4\u8BC1\u4FE1\u606F\u7684\u914D\u7F6E</span>
<span class="token comment">#spring.data.mongodb.uri=mongodb://192.168.31.81:27017/tanhua</span>

<span class="token comment">#springboot \u914D\u7F6E</span>
<span class="token key attr-name">spring.data.mongodb.username</span><span class="token punctuation">=</span><span class="token value attr-value">tanhua</span>
<span class="token key attr-name">spring.data.mongodb.password</span><span class="token punctuation">=</span><span class="token value attr-value">l3SCjl0HvmSkTtiSbN0Swv40spYnHhDV</span>
<span class="token key attr-name">spring.data.mongodb.authentication-database</span><span class="token punctuation">=</span><span class="token value attr-value">admin</span>
<span class="token key attr-name">spring.data.mongodb.database</span><span class="token punctuation">=</span><span class="token value attr-value">tanhua</span>
<span class="token key attr-name">spring.data.mongodb.port</span><span class="token punctuation">=</span><span class="token value attr-value">27018</span>
<span class="token key attr-name">spring.data.mongodb.host</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.31.81</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3\u3001\u7F16\u5199\u5B9E\u4F53" tabindex="-1"><a class="header-anchor" href="#_4-3\u3001\u7F16\u5199\u5B9E\u4F53" aria-hidden="true">#</a> 4.3\u3001\u7F16\u5199\u5B9E\u4F53</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>pojo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>bson<span class="token punctuation">.</span>types<span class="token punctuation">.</span></span><span class="token class-name">ObjectId</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">ObjectId</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Address</span> address<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>pojo</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">NoArgsConstructor</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Address</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> street<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> city<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> zip<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4\u3001\u7F16\u5199dao" tabindex="-1"><a class="header-anchor" href="#_4-4\u3001\u7F16\u5199dao" aria-hidden="true">#</a> 4.4\u3001\u7F16\u5199dao</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Person</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>client<span class="token punctuation">.</span>result<span class="token punctuation">.</span></span><span class="token class-name">DeleteResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>client<span class="token punctuation">.</span>result<span class="token punctuation">.</span></span><span class="token class-name">UpdateResult</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">MongoTemplate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>core<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">Criteria</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>core<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">Query</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>core<span class="token punctuation">.</span>query<span class="token punctuation">.</span></span><span class="token class-name">Update</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PersonDao</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MongoTemplate</span> mongoTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">savePerson</span><span class="token punctuation">(</span><span class="token class-name">Person</span> person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mongoTemplate<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryPersonListByName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token class-name">Query</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryPersonPageList</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> page<span class="token punctuation">,</span> <span class="token class-name">Integer</span> rows<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>rows<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token punctuation">(</span>page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> rows<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mongoTemplate<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">UpdateResult</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Person</span> person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token class-name">Query</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Update</span> update <span class="token operator">=</span> <span class="token class-name">Update</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> person<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mongoTemplate<span class="token punctuation">.</span><span class="token function">updateFirst</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> update<span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">DeleteResult</span> <span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Query</span> query <span class="token operator">=</span> <span class="token class-name">Query</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">Criteria</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mongoTemplate<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-5\u3001\u7F16\u5199\u542F\u52A8\u7C7B" tabindex="-1"><a class="header-anchor" href="#_4-5\u3001\u7F16\u5199\u542F\u52A8\u7C7B" aria-hidden="true">#</a> 4.5\u3001\u7F16\u5199\u542F\u52A8\u7C7B</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mongodb</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MongoApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">MongoApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-6\u3001\u7F16\u5199\u5355\u5143\u6D4B\u8BD5" tabindex="-1"><a class="header-anchor" href="#_4-6\u3001\u7F16\u5199\u5355\u5143\u6D4B\u8BD5" aria-hidden="true">#</a> 4.6\u3001\u7F16\u5199\u5355\u5143\u6D4B\u8BD5</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mongodb</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">PersonDao</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Address</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>itcast<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>pojo<span class="token punctuation">.</span></span><span class="token class-name">Person</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>bson<span class="token punctuation">.</span>types<span class="token punctuation">.</span></span><span class="token class-name">ObjectId</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner<span class="token punctuation">.</span></span><span class="token class-name">RunWith</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4<span class="token punctuation">.</span></span><span class="token class-name">SpringRunner</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestPersonDao</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">PersonDao</span> personDao<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testSave</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">ObjectId</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;\u5F20\u4E09&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">Address</span><span class="token punctuation">(</span><span class="token string">&quot;\u4EBA\u6C11\u8DEF&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;\u4E0A\u6D77\u5E02&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;666666&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>personDao<span class="token punctuation">.</span><span class="token function">savePerson</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> personList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>personDao<span class="token punctuation">.</span><span class="token function">queryPersonListByName</span><span class="token punctuation">(</span><span class="token string">&quot;\u5F20\u4E09&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Person</span> person <span class="token operator">:</span> personList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testQuery2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> personList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>personDao<span class="token punctuation">.</span><span class="token function">queryPersonPageList</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Person</span> person <span class="token operator">:</span> personList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        person<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ObjectId</span><span class="token punctuation">(</span><span class="token string">&quot;5c0956ce235e192520086736&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        person<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>personDao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>personDao<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token string">&quot;5c09ca05235e192d8887a389&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,189),F=[O];function T(L,N){return s(),a("div",null,F)}const G=n(A,[["render",T],["__file","day02-\u5B8C\u5584\u4E2A\u4EBA\u4FE1\u606F\u4E0EMongoDB\u5165\u95E8.html.vue"]]);export{G as default};
